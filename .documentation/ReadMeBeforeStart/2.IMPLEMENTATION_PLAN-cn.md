# EcoSphere å°å‹ç³»ç»ŸåŸå‹ - å®ç°è®¡åˆ’

> **ğŸ“Œ æ³¨æ„**: æœ¬æ–‡æ¡£ä¸ºåŸå§‹å®æ–½è®¡åˆ’å’Œç±»è®¾è®¡å‚è€ƒã€‚  
> **æœ€æ–°é¡¹ç›®ç°çŠ¶è¯·æŸ¥çœ‹**:  
> - ä¸­æ–‡: [`4.CURRENT_STATE_2026-01-EN.md`](./4.CURRENT_STATE_2026-01-EN.md) (ç®€æ´ç‰ˆï¼Œ~800è¡Œ)  
> - è‹±æ–‡: [`5.CURRENT_STATE_2026-01.md`](./5.CURRENT_STATE_2026-01.md) (ç®€æ´ç‰ˆï¼Œ~800è¡Œ)

**æœ€åæ›´æ–°**: 2026-01-16
**çŠ¶æ€**: âœ… P0å·²å®Œæˆ | âœ… P1å·²å®Œæˆ | âœ… P2å·²å®Œæˆ95%
**é¡¹ç›®é˜¶æ®µ**: Phase 3 - Small System Prototype

---

## é¡¹ç›®æ¦‚è¿°

### èƒŒæ™¯

EcoSphereæ˜¯ä¸ºSAITçš„Green Building Technology Access Centre (GBTAC)å¼€å‘çš„æ™ºèƒ½å»ºç­‘åˆ†æç³»ç»Ÿã€‚
ç³»ç»Ÿé€šè¿‡ä¼ æ„Ÿå™¨æ”¶é›†å»ºç­‘çš„æ°´ã€ç”µã€çƒ­èƒ½æ•°æ®ï¼Œå­˜å‚¨åœ¨SQL Serveræ•°æ®åº“ä¸­ï¼ŒEcoSphereä»¥åªè¯»æ–¹å¼è®¿é—®è¿™äº›æ•°æ®ï¼Œ
ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Šã€é¢„æµ‹åˆ†æå’Œäº¤äº’å¼ä»ªè¡¨æ¿ã€‚

### Phase 3è¦æ±‚

**âœ… P0 - å·²å®Œæˆ**:
1. âœ… ç™»å½•æ¨¡å— - ç”¨æˆ·è®¤è¯å’Œä¼šè¯ç®¡ç†
2. âœ… ç”¨æˆ·ç®¡ç†æ¨¡å— - Adminæ·»åŠ /ç¼–è¾‘ç”¨æˆ·ï¼ˆæ— æ³¨å†ŒåŠŸèƒ½ï¼‰
3. âœ… ç¢³è¶³è¿¹è¿½è¸ªæ¨¡å— - ä¸¤ç§è®¡ç®—æ¨¡å¼ï¼ˆMockæ•°æ®è‡ªåŠ¨è®¡ç®— + ç”¨æˆ·ä¸´æ—¶ä¸Šä¼ ï¼‰

**âœ… P1 - å·²å®Œæˆ**:
4. âœ… ç”µåŠ›ä»ªè¡¨æ¿æ¨¡å— - 4ä¸ªæ ‡ç­¾é¡µï¼ˆæ¶ˆè€—ã€å‘ç”µã€å‡€èƒ½æºã€é¢„æµ‹ï¼‰

**âœ… P2 - å·²å®Œæˆ95%**:
5. âœ… çƒ­èƒ½ä»ªè¡¨æ¿æ¨¡å— - å®Œæ•´å®ç°ï¼ˆåŒ…å«é¢„æµ‹åŠŸèƒ½ï¼‰
6. âœ… æ°´èµ„æºä»ªè¡¨æ¿ - å®Œæ•´å®ç°ï¼ˆåŒ…å«é¢„æµ‹åŠŸèƒ½ï¼‰
7. âœ… å¤©ç„¶æ°”ä»ªè¡¨æ¿ - å®Œæ•´å®ç°ï¼ˆåŒ…å«é¢„æµ‹åŠŸèƒ½ï¼‰
8. âœ… æ€»è§ˆä»ªè¡¨æ¿ - å®Œæ•´å®ç°ï¼ˆç»Ÿä¸€è§†å›¾ï¼‰
9. âœ… Forecasté¢„æµ‹åŠŸèƒ½ - å®Œæ•´å®ç°ï¼ˆç”µåŠ›ã€æ°´èµ„æºã€çƒ­åŠ›ã€å¤©ç„¶æ°”ï¼‰
10. â¸ï¸ 3Då¯è§†åŒ– - æœªå¼€å§‹
11. â¸ï¸ AI Chatbot (EVA) - æœªå¼€å§‹
12. â¸ï¸ Quiz System - æœªå¼€å§‹

**å…³é”®è¦æ±‚**:
- ç³»ç»Ÿä¸º**å†…éƒ¨ç³»ç»Ÿ**ï¼Œæ— æ³¨å†ŒåŠŸèƒ½ï¼Œç”¨æˆ·ç”±Adminç»Ÿä¸€ç®¡ç†
- ä»¥åªè¯»æ–¹å¼è®¿é—®SQL Serveræ•°æ®åº“
- æ‰€æœ‰å®ç°éµå¾ªclass-diagram-optimized.pumlä¸­å®šä¹‰çš„ç±»ç»“æ„ï¼ˆä½œä¸ºè®¾è®¡å‚è€ƒï¼‰

---

## æŠ€æœ¯æ ˆï¼ˆå®é™…ä½¿ç”¨ï¼‰

### å‰ç«¯
- **æ¡†æ¶**: React 19.2.0 + Vite 7.2.4
- **UIåº“**: Material-UI 7.3.5
- **çŠ¶æ€ç®¡ç†**: Context API (AuthContext)
- **æ•°æ®å¯è§†åŒ–**: Chart.js 4.5.1 + react-chartjs-2 5.3.1
- **è·¯ç”±**: React Router 7.9.6
- **æ—¥æœŸå¤„ç†**: date-fns 4.1.0
- **PDFå¯¼å‡º**: jsPDF 3.0.4 + html2canvas 1.4.1
- **æ—¶é—´åºåˆ—åˆ†æ**: timeseries-analysis 1.0.12 (åç«¯)

### åç«¯
- **è¿è¡Œæ—¶**: Node.js + Express 5.1.0
- **APIè®¾è®¡**: RESTful API
- **è®¤è¯**: Session-based (sessionStorage)
- **æ¶æ„**: Routes â†’ Controllers â†’ Services â†’ Data

### æ•°æ®åº“
- **SQL Server**: Thermal + Electricity + Water + Carbon Footprint æ¨¡å—ï¼ˆC:\XW\SAIT\GB\TestSlimDB.mdfï¼‰
- **JSONæ–‡ä»¶**: Natural Gas æ¨¡å—ï¼ˆæœˆåº¦æ•°æ®ï¼Œ2023-2025ï¼‰
- **Mock JSON**: Users, Login Logsï¼ˆå¾…è¿ç§»åˆ°SQL Serverï¼‰
- **è¿æ¥æ–¹å¼**: sqlcmdå‘½ä»¤è¡Œå·¥å…·ï¼ŒWindows Authentication

### å¤–éƒ¨API
- **Electricity Maps API**: å†å²ç¢³å¼ºåº¦æ•°æ®ï¼ˆAlberta, CA-ABï¼‰
- **Open-Meteo API**: å¤©æ°”æ•°æ®ï¼ˆå†å²å’Œé¢„æµ‹ï¼‰
  - ç”¨äºå‘ç”µé‡é¢„æµ‹ï¼ˆå¤ªé˜³è¾å°„ï¼‰
  - ç”¨äºé›¨æ°´é¢„æµ‹ï¼ˆé™æ°´é‡ï¼‰
  - ç”¨äºçƒ­åŠ›é¢„æµ‹ï¼ˆå®¤å¤–æ¸©åº¦ï¼‰

---

## ç±»å›¾ä¸¥æ ¼éµå¾ªåŸåˆ™

### é‡è¦è¯´æ˜

ç±»å›¾ï¼ˆ`class-diagram-optimized.puml`ï¼‰ä½œä¸ºç³»ç»Ÿè®¾è®¡çš„å‚è€ƒã€‚å®é™…å®ç°ä¸­ï¼š
- ç±»å®šä¹‰ä½œä¸ºæ¶æ„æŒ‡å¯¼
- å®é™…ä»£ç é‡‡ç”¨React Hookså’ŒServiceå±‚æ¨¡å¼
- ç±»ä¹‹é—´çš„å…³ç³»ä½“ç°åœ¨ç»„ä»¶å’ŒæœåŠ¡çš„äº¤äº’ä¸­

### ç±»å›¾å…³é”®å…³ç³»

```
User (æŠ½è±¡)
  â”œâ”€â”€ Admin (ç»§æ‰¿)
  â””â”€â”€ TeamMember (ç»§æ‰¿)

Report (æŠ½è±¡)
  â”œâ”€â”€ WaterReport (ç»§æ‰¿)
  â”œâ”€â”€ ElectricityReport (ç»§æ‰¿)
  â””â”€â”€ ThermalReport (ç»§æ‰¿)

CarbonFootprint "1" o-- "*" BillEntry (ç»„åˆ)
CarbonFootprint "1" --> "1" ElectricityReport (ä¾èµ–)

Dashboard --> Visualizer (ä½¿ç”¨)
Dashboard --> Report (èšåˆ)
Dashboard ..> AccessControl (ä¾èµ–)
```

---

## æ ¸å¿ƒç±»å®šä¹‰

ä»¥ä¸‹ç±»å®šä¹‰æ¥è‡ªclass-diagram-optimized.pumlï¼Œä½œä¸ºè®¾è®¡å‚è€ƒï¼š

### 1. Userç±»ï¼ˆæŠ½è±¡ç±»ï¼‰

**Package**: User Management

**Attributes**:
- id: int
- firstName: String
- lastName: String
- email: String
- password: String
- role: String

**Methods**:
- createUser(id, ...): void
- login(email, password): void
- logout(): void

**å­ç±»**:
- `Admin` - é¢å¤–æ–¹æ³•ï¼šaddUser(), editUserPermissions(), assignRole()
- `TeamMember` - é¢å¤–å±æ€§ï¼špromptChat, permissions; é¢å¤–æ–¹æ³•ï¼šgetPermissions()

---

### 2. CarbonFootprintç±»

**Package**: Carbon Analysis

**Attributes**:
- id: int
- co2Emission: double
- billEntries: List

**Methods**:
- calculateFootprint(...): double
- addBillEntry(...): void
- overrideWithDIY(): DataSet

---

### 3. BillEntryç±»

**Package**: Carbon Analysis

**Attributes**:
- id: int
- year: int
- month: String
- electricityUsage: double

---

### 4. Reportç±»ï¼ˆæŠ½è±¡ç±»ï¼‰

**Package**: Reporting System

**Attributes**:
- id: int
- reportType: String

**Methods**:
- exportReport(): void
- filterReport(...): void

**å­ç±»**: WaterReport, ElectricityReport, ThermalReport

---

### 5. ElectricityReportç±»

**Package**: Reporting System

**ç»§æ‰¿**: Report

**ç‰¹æœ‰Attributes**:
- electricityConsumption: double
- electricityGeneration: double

**Methods**:
- calculateCarbonFootprint(...): double
- generateHotspotMap(...): Map
- generateCarbonVsConsumptionChart(): Chart

---

### 6. Dashboardç±»

**Package**: User Interface

**Attributes**:
- id: int
- dashboardType: String

**Methods**:
- generateView(user, type): DashboardView
- filterByPermissions(user): List

---

### 7. Visualizerç±»

**Package**: Visualization

**Attributes**:
- id: int
- visualizeType: String

**Methods**:
- generateGraph(...): void
- calculateSelfSufficiency(...): double
- renderHotspotMap(...): Map
- renderHeatMap(...): Map

---

### 8. AccessControlç±»

**Package**: Security

**Methods** (Static):
- checkPermission(user, module): boolean
- updateUserPermissions(userId, permissions): void

---

## æ•°æ®åº“è®¾è®¡

### åŸºäºERDå›¾çš„è¡¨ç»“æ„

å‚è€ƒæ–‡æ¡£: `instructions/ref/erd-diagram.puml`

### 1. USERSè¡¨

```sql
CREATE TABLE USERS (
    id INT PRIMARY KEY IDENTITY(1,1),
    firstName NVARCHAR(100) NOT NULL,
    lastName NVARCHAR(100) NOT NULL,
    email NVARCHAR(255) NOT NULL UNIQUE,
    password NVARCHAR(255) NOT NULL,
    role NVARCHAR(50) NOT NULL CHECK (role IN ('SuperAdmin', 'Admin', 'TeamMember')),
    promptChat INT NULL,
    permissions NVARCHAR(MAX) NULL,
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

### 2. REPORTSè¡¨ï¼ˆåŸºç¡€è¡¨ï¼‰

```sql
CREATE TABLE REPORTS (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    report_type NVARCHAR(50) NOT NULL CHECK (report_type IN ('Water', 'Electricity', 'Thermal')),
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

### 3. ELECTRICITY_REPORTSè¡¨

```sql
CREATE TABLE ELECTRICITY_REPORTS (
    id INT PRIMARY KEY FOREIGN KEY REFERENCES REPORTS(id),
    electricityConsumption DECIMAL(10,2) NOT NULL,
    electricityGeneration DECIMAL(10,2) NOT NULL,
    carbonFootprint DECIMAL(10,2) NULL,
    selfSufficiency DECIMAL(5,2) NULL
);
```

### 4. CARBON_FOOTPRINTè¡¨

```sql
CREATE TABLE CARBON_FOOTPRINT (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    report_id INT NULL FOREIGN KEY REFERENCES ELECTRICITY_REPORTS(id),
    co2Emission DECIMAL(10,2) NOT NULL,
    calculation_source NVARCHAR(50) NOT NULL CHECK (calculation_source IN ('database', 'user_upload')),
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

### 5. BILL_ENTRYè¡¨

```sql
CREATE TABLE BILL_ENTRY (
    id INT PRIMARY KEY IDENTITY(1,1),
    carbonFootprintId INT NOT NULL FOREIGN KEY REFERENCES CARBON_FOOTPRINT(id),
    year INT NOT NULL,
    month NVARCHAR(20) NOT NULL,
    electricityUsage DECIMAL(10,2) NOT NULL,
    created_at DATETIME DEFAULT GETDATE()
);
```

### 6. HISTORY_LOGSè¡¨

```sql
CREATE TABLE HISTORY_LOGS (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    log_type NVARCHAR(50) NOT NULL CHECK (log_type IN ('report', 'ai_query')),
    timestamp DATETIME DEFAULT GETDATE(),
    details NVARCHAR(MAX) NULL
);
```

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨Session-basedè®¤è¯è€Œä¸æ˜¯JWTï¼Ÿ
- **åŸå› **: Prototypeé˜¶æ®µç®€åŒ–å®ç°
- **å½“å‰**: sessionStorageå­˜å‚¨ç”¨æˆ·ä¿¡æ¯
- **æœªæ¥**: å¯èƒ½è¿ç§»åˆ°JWT + Firebase

### 2. ä¸ºä»€ä¹ˆéƒ¨åˆ†ä½¿ç”¨Mockæ•°æ®ï¼Ÿ
- **åŸå› **: å®¢æˆ·æ•°æ®è¡¨ç»“æ„æœªæœ€ç»ˆç¡®å®š
- **å½“å‰**: Thermalå’ŒElectricityä½¿ç”¨SQL Serverï¼Œå…¶ä»–ä½¿ç”¨Mock JSON
- **ç­–ç•¥**: é€æ­¥è¿ç§»åˆ°SQL Server

### 3. ä¸ºä»€ä¹ˆé‡‡ç”¨Functional Componentsè€Œä¸æ˜¯OOP Classesï¼Ÿ
- **åŸå› **: Reactç”Ÿæ€ç³»ç»Ÿæ›´é€‚åˆHooksæ¨¡å¼
- **å®ç°**: ä½¿ç”¨Custom Hooks + Serviceå±‚
- **ç±»å›¾ä½œç”¨**: ä½œä¸ºæ¶æ„è®¾è®¡å‚è€ƒï¼Œä¸æ˜¯å¼ºåˆ¶å®ç°

### 4. ä¸ºä»€ä¹ˆæ²¡æœ‰å¯†ç åŠ å¯†ï¼Ÿ
- **åŸå› **: Prototypeé˜¶æ®µï¼Œå®‰å…¨æ€§å»¶ååˆ°æœ€ç»ˆç‰ˆæœ¬
- **æœªæ¥**: å®ç°bcryptå¯†ç å“ˆå¸Œ

---

## å‚è€ƒæ–‡æ¡£

### Phase 3 è¦æ±‚æ–‡æ¡£
- **ä¸»æ–‡æ¡£**: `instructions/Phase3_extracted.md`

### Phase 2 è®¾è®¡æ–‡æ¡£
- **ä¸»æ–‡æ¡£**: `instructions/ref/Phase2_extracted.md`
- **Use Caseæè¿°**: Page 11-22
- **åŠŸèƒ½éœ€æ±‚**: Page 5-6

### UMLå›¾è¡¨
- **ç±»å›¾**: `instructions/ref/class-diagram-optimized.puml`
- **ERDå›¾**: `instructions/ref/erd-diagram.puml`
- **åºåˆ—å›¾**: `deliverables/seq-*.puml`
- **æ´»åŠ¨å›¾**: `deliverables/activity-*.puml`

---

**æ–‡æ¡£ç»“æŸ**
