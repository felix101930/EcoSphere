# EcoSphere Small System Prototype - Complete Implementation Plan

**Last Updated**: 2025-11-28
**Status**: ✅ P0 Completed | 🔄 P1 In Progress
**Priority**: High
**Project Phase**: Phase 3 - Small System Prototype
**Version**: 4.0 (Updated based on actual development)

---

## 🎯 Implementation Progress Overview

| Priority | Module                           | Status        | Completion |
| -------- | -------------------------------- | ------------- | ---------- |
| P0       | Login Module                     | ✅ Complete   | 100%       |
| P0       | User Management Module           | ✅ Complete   | 100%       |
| P0       | Carbon Footprint Tracking Module | ✅ Complete   | 100%       |
| P1       | Electricity Dashboard Module     | ⏳ Pending    | 0%         |
| P2       | Other Report Modules             | ⏸️ Skeleton | 0%         |
| P2       | Forecast Prediction Feature      | ⏸️ Skeleton | 0%         |
| P2       | Period Comparison                | ⏸️ Skeleton | 0%         |
| P2       | 3D Visualization                 | ⏸️ Skeleton | 0%         |

**Overall Progress**: P0 ✅ 100% | P1 ⏳ 0% | P2 ⏸️ 0%

---

## 📋 Table of Contents

1. [Project Overview](#project-overview)
2. [Prototype Scope](#prototype-scope)
3. [Technology Stack](#technology-stack)
4. [Class Diagram Strict Compliance Principles](#class-diagram-strict-compliance-principles)
5. [Core Class Definitions](#core-class-definitions)
6. [Database Design](#database-design)
7. [Backend Implementation](#backend-implementation)
8. [Frontend Implementation](#frontend-implementation)
9. [Implementation Steps](#implementation-steps)
10. [Class Diagram Relationship Checklist](#class-diagram-relationship-checklist)
11. [Reference Documents](#reference-documents)

---

## Project Overview

### Background

EcoSphere is a smart building analytics system developed for SAIT's Green Building Technology Access Centre (GBTAC).
The system collects water, electricity, and thermal energy data from building sensors, stores them in a SQL Server database,
and EcoSphere accesses this data in read-only mode to generate visualization reports, predictive analysis, and interactive dashboards.

### Phase 3 Requirements (Actual Completion Status)

**✅ P0 - Completed (Demo Core)**:

1. ✅ **Login Module** - User authentication and session management
2. ✅ **User Management Module** - Admin add/edit users (no registration feature)
3. ✅ **Carbon Footprint Tracking Module** - Non-trivial use case
   - ✅ Supports automatic calculation from Mock data (based on electricity data)
   - ✅ Supports user temporary upload for calculation (not persisted)
   - ✅ Three views: Real-time, Daily, Long-term
   - ✅ Chart.js dual-line chart visualization
   - ✅ Electricity Maps API integration

**🔄 P1 - To Be Implemented**:
4. **Electricity Dashboard Module** - Basic data display

**⏸️ P2 - Skeleton Implementation (Framework setup, features to be implemented in future)**:

- Other Report modules (Water, Thermal)
- Forecast prediction feature (requires real algorithms, not implemented in prototype phase)
- Period Comparison feature
- 3D visualization

**Key Requirements**:

- All implementations must strictly follow the class structure defined in class-diagram-optimized.puml
- System is **internal**, no registration feature, all users managed by Admin
- Carbon footprint supports two calculation modes (Mock data + temporary upload)

### Actual Development Status Explanation

**✅ Completed Adjustments**:

1. **Data Storage**: Using Mock data (JSON files) instead of SQL Server

   - Reason: Client data table structure not finalized
   - Future: Migrate to SQL Server in Week 1-2
2. **Authentication Method**: Using Session-based authentication instead of JWT

   - Reason: Simplified implementation for Prototype phase
   - Current: sessionStorage stores user information
   - Future: Implement JWT token authentication
3. **Component Architecture**: Adopting Container/Presentation pattern

   - Avoid God Mode (single component containing all logic)
   - Each component has single responsibility, reusable
   - Components not exceeding 150 lines of code
4. **External API Integration**: Electricity Maps API

   - Get real-time carbon intensity data (Alberta, Calgary)
   - Manage API keys using environment variables

**🔄 Technology Stack Adjustments**:

- Build Tool: Vite (faster, more modern)
- UI Library: Material-UI (professional, rich components)
- Chart Library: Chart.js (free, locally generated)
- State Management: Context API (lightweight)

---

## Prototype Scope

### 1. Login & User Management Module - ✅ P0 Completed

**Implementation Status**: ✅ 100% Complete

**Implemented Features**:

- ✅ User login interface (email/password)
- ✅ Authentication and Session management (sessionStorage)
- ✅ Permission checking and route protection
- ✅ Post-login role-based navigation (Admin → User Management, TeamMember → Dashboard)
- ✅ **Admin User Management Features**:
  - ✅ Add new user (createUser)
  - ✅ Edit user information (editUser)
  - ✅ Delete user (deleteUser)
  - ✅ Assign roles and permissions (assignRole, editUserPermissions)
  - ✅ View user list (UserTable component)
  - ✅ Multi-select permissions (Electricity, Water, Thermal, 3D Model, Carbon Footprint)
- ✅ **Component Architecture**:
  - ✅ UserManagementPage (container component)
  - ✅ UserTable, UserTableRow (presentation components)
  - ✅ UserDialog, UserForm (form components)
  - ✅ AlertMessage (common component)

**Implemented Classes** (strictly following class-diagram-optimized.puml):

- ✅ `User` (abstract class) - `ecosphere-frontend/src/models/User.js`
- ✅ `Admin` (inherits User) - `ecosphere-frontend/src/models/Admin.js`
- ✅ `TeamMember` (inherits User) - `ecosphere-frontend/src/models/TeamMember.js`
- ✅ `AccessControl` - `ecosphere-frontend/src/models/AccessControl.js`

**Backend API** (RESTful):

- ✅ GET `/api/users` - Get all users
- ✅ GET `/api/users/:id` - Get single user
- ✅ POST `/api/users` - Create new user
- ✅ PUT `/api/users/:id` - Update user
- ✅ DELETE `/api/users/:id` - Delete user
- ✅ POST `/api/auth/login` - User login

**Test Accounts**:

- Admin: `admin.admin@edu.sait.ca` / `abcd1234`
- TeamMember: Created by Admin

**Implementation Priority**: ✅ P0 - Completed

---

### 2. Carbon Footprint Tracking Module - ✅ P0 Completed

**Implementation Status**: ✅ 100% Complete

**Implemented Features**:

- ✅ **Mode 1: Automatic Calculation from Mock Data**

  - ✅ Read electricity consumption data from electricity.json (3 months, hourly)
  - ✅ Integrate Electricity Maps API to get real-time carbon intensity
  - ✅ Automatically calculate carbon footprint (CO2 = electricity consumption × carbon intensity)
  - ✅ Three views: Real-time (today), Daily (user-selected range), Long-term (3 months)
  - ✅ Display historical carbon footprint trends
- ✅ **Mode 2: User Temporary Upload (Custom Calculator)**

  - ✅ User uploads electricity bill data (year, month, electricity usage)
  - ✅ Real-time carbon footprint calculation
  - ✅ **Data not persisted** (only stored in React state)
  - ✅ Dynamically add/remove bill entries
  - ✅ Data validation (prevent duplicate year/month, prevent future dates)
  - ✅ Automatic sorting (by year/month)
  - ✅ Smart date restrictions (year limited to current year, month limited to current month)
- ✅ **Data Visualization**

  - ✅ Chart.js dual-line chart (Carbon Footprint + Electricity Consumption)
  - ✅ Dual Y-axis (left: kg CO2, right: kWh)
  - ✅ SAIT color scheme (red + blue)
  - ✅ Responsive design
- ✅ **Date/Time Handling**

  - ✅ Use user's local system time (Calgary time)
  - ✅ Daily View defaults to past 10 days to today
  - ✅ Prevent selection of future dates

**Implemented Classes/Services** (functionality implemented through Service layer):

- ✅ `ElectricityMapsService` - Carbon intensity API and calculation
  - `getCurrentCarbonIntensity()` - Get real-time carbon intensity
  - `calculateCarbonFootprint()` - Calculate carbon footprint
  - `getCarbonIntensityInKg()` - Unit conversion
- ✅ `ElectricityService` - Electricity data management
  - `getRealTimeData()` - Get real-time data
  - `getDailyData()` - Get daily data
  - `getLongTermData()` - Get long-term data
  - `getDataByRange()` - Get by date range
  - `calculateTotalEnergy()` - Calculate total energy consumption
- ✅ `CarbonFootprintPage` - Main page container
- ✅ `CustomCalculator` - User temporary calculation component (BillEntry functionality)

**Backend API**:

- ✅ GET `/api/electricity/realtime` - Get real-time data
- ✅ GET `/api/electricity/range?startDate=...&endDate=...` - Get range data
- ✅ GET `/api/electricity/longterm` - Get long-term data

**Mock Data**:

- ✅ `mock-data/electricity.json` - 3 months electricity data (hourly)
- ✅ `mock-data/carbonFootprint.json` - Carbon footprint historical data

**External API Integration**:

- ✅ Electricity Maps API - Real-time carbon intensity (Alberta, Calgary)
- ✅ Environment variable management (.env file)

**Implementation Priority**: ✅ P0 - Completed (non-trivial use case)

---

### 3. Electricity Dashboard Module - 🔄 P1 To Be Implemented

**Implementation Status**: ⏳ Pending

**Planned Features**:

- ⏳ Real-time display of electricity consumption and generation data
- ⏳ Data visualization (charts, dashboards)
- ⏳ Historical data query and time period filtering
- ⏳ **Core Feature**: Integrate carbon footprint data display in electricity reports
- ⏳ Basic self-sufficiency rate calculation

**Future Features (Subsequent versions)**:

- 🔮 Generate forecast reports (Forecast) - Requires real prediction algorithms
- 🔮 Period comparison (YoY/PoP)
- 🔮 Export report functionality (PDF)

**Classes to be Implemented** (from class-diagram-optimized.puml):

- ⏳ `ElectricityReport` class (inherits Report)
  - Attributes: id, reportType, electricityConsumption, electricityGeneration
  - Methods: calculateCarbonFootprint(), generateHotspotMap(), generateCarbonVsConsumptionChart()
  - Inherited Methods: exportReport(), filterReport()
- ⏳ `Report` class (abstract class)
  - Attributes: id, reportType
  - Methods: exportReport(), filterReport()
- ⏳ `Dashboard` class
  - Attributes: id, dashboardType
  - Methods: generateView(), filterByPermissions()
- ⏳ `Visualizer` class
  - Attributes: id, visualizeType
  - Methods: generateGraph(), calculateSelfSufficiency(), renderHotspotMap()

**Technology Stack Adjustments**:

- Continue using Chart.js for visualization
- Continue using Mock data (electricity.json)
- Integrate completed carbon footprint calculation functionality

**Implementation Priority**: 🔄 P1 - Implement if time allows

- `PeriodComparison` class
  - Attributes: id
  - Methods: comparePoP(), compareYoY(), compareCustom()
- `Filter` class
  - Attributes: id, location, area, timePeriod
  - Methods: applyFilter(), resetToDefault()
- `ReportCustomization` class
  - Attributes: id, includeGraphs
  - Methods: preview(), download()

**Use Case Reference**:

- UC-007 (View Dashboards) - Phase2_extracted.md Page 17-18
- UC-006 (Generate Forecast) - Phase2_extracted.md Page 15-16 (Future implementation)

**Sequence Diagram Reference**: deliverables/seq-electricity-dashboard.puml

**Activity Diagram Reference**: deliverables/activity-electricity-dashboard.puml

**Key Integration Points**:

- ElectricityReport must call CarbonFootprint.calculateFootprint()
- Reports must display both electricity data and carbon footprint data simultaneously

**Implementation Priority**: 🟡 P1 - Implement if time allows (Basic version)

---

## Technology Stack (Actually Used)

### Frontend ✅

- **Framework**: Vite + React.js 18.x (JSX)
- **UI Library**: Material-UI (MUI) 5.x
- **State Management**: Context API (AuthContext)
- **Data Visualization**: Chart.js 4.x + react-chartjs-2
- **Routing**: React Router 6.x
- **HTTP Client**: Fetch API (native)
- **Fonts**: Titillium Web (headings) + DM Sans (body)
- **Color Scheme**: SAIT official colors (#DA291C, #005EB8, etc.)

### Backend ✅

- **Runtime**: Node.js 18.x+
- **Framework**: Express.js 4.x
- **API Design**: RESTful API
- **Authentication**: Session-based (sessionStorage)
- **Architecture**: Routes → Controllers → Services → Utils

### Database (Prototype Phase) ⚠️

- **Current Solution**: Mock data (JSON files)
  - `mock-data/users.json` - User data
  - `mock-data/electricity.json` - Electricity data (3 months, hourly)
  - `mock-data/carbonFootprint.json` - Carbon footprint historical data
- **Future Solution**: Microsoft SQL Server (Week 1-2 migration)
- **Reason**: Client data table structure not finalized, rapid development in Prototype phase

### External API ✅

- **Electricity Maps API**: Real-time carbon intensity data (Alberta, Calgary)
- **Environment Variables**: `.env` file manages API keys

### Development Tools ✅

- **Version Control**: Git / GitHub
- **Code Editor**: VS Code / Kiro IDE
- **API Testing**: Browser DevTools
- **UML Tool**: PlantUML
- **UI Design**: Figma

---

## Class Diagram Strict Compliance Principles

### ⚠️ Important Note

**Prototype implementation must 100% strictly follow the class structure defined in `instructions/ref/class-diagram-optimized.puml`.**

Although there may be adjustments in actual development, the class diagram is the outline and foundation for implementation. All class attributes and methods must be consistent with the class diagram.

### Implementation Rules

1. **Attribute Completeness**: All classes must include all attributes defined in the class diagram
2. **Method Signature Consistency**: All methods must be implemented according to the signatures in the class diagram (parameters and return types)
3. **Relationship Implementation**: Relationships between classes must be reflected in code (inheritance, composition, aggregation, dependency)
4. **Naming Consistency**: Method and attribute naming must be consistent with the class diagram
5. **Package Structure**: Follow the package organization structure in the class diagram

### Key Class Diagram Relationships

```
User (abstract)
  ├── Admin (inheritance)
  └── TeamMember (inheritance)

Report (abstract)
  ├── WaterReport (inheritance)
  ├── ElectricityReport (inheritance)
  └── ThermalReport (inheritance)

CarbonFootprint "1" o-- "*" BillEntry (composition)
CarbonFootprint "1" --> "1" ElectricityReport (dependency)

UI "1" *-- "1" CarbonFootprint (composition)
UI "1" *-- "*" Dashboard (composition)
UI "1" o-- "*" Report (aggregation)

Dashboard --> Visualizer (uses)
Dashboard --> Report (aggregates)
Dashboard ..> AccessControl (dependency)

Visualizer --> Report (visualizes)
Forecast --> Report (generates)
Report --> PeriodComparison (compares)
```

---

## Core Class Definitions

The following class definitions come directly from `class-diagram-optimized.puml` and must be strictly followed:

### 1. User Class (Abstract Class)

**Package**: User Management

**Attributes**:

```
- id: int
- firstName: String
- lastName: String
- email: String
- password: String
- role: String
```

**Methods**:

```
+ createUser(id, ...): void
+ login(email, password): void
+ logout(): void
```

**Subclasses**:

- `Admin` - Administrator, additional methods: addUser(), editUserPermissions(), assignRole(), createQuiz(), editQuiz(), deleteQuiz()
- `TeamMember` - Team member, additional attributes: promptChat (int), permissions (List), additional method: getPermissions()

---

### 2. CarbonFootprint Class

**Package**: Carbon Analysis

**Attributes**:

```
- id: int
- co2Emission: double
- billEntries: List
```

**Methods**:

```
+ calculateFootprint(...): double
+ addBillEntry(...): void
+ overrideWithDIY(): DataSet
```

**Relationships**:

- Composition: `CarbonFootprint "1" o-- "*" BillEntry : stores`
- Dependency: `CarbonFootprint "1" --> "1" ElectricityReport : calculates`
- Composition: `UI "1" *-- "1" CarbonFootprint : owns`

---

### 3. BillEntry Class

**Package**: Carbon Analysis

**Attributes**:

```
- id: int
- year: int
- month: String
- electricityUsage: double
```

**Relationships**: Contained by CarbonFootprint

---

### 4. Report Class (Abstract Class)

**Package**: Reporting System

**Attributes**:

```
- id: int
- reportType: String
```

**Methods**:

```
+ exportReport(): void
+ filterReport(...): void
```

**Subclasses**: WaterReport, ElectricityReport, ThermalReport

**Relationships**:

- Dependency: `Report ..> Database : queries`
- Dependency: `Report ..> AccessControl : checks permission`
- Association: `Forecast --> Report : generates`
- Association: `Report --> PeriodComparison : compares`

---

### 5. ElectricityReport Class

**Package**: Reporting System

**Inherits**: Report (abstract class)

**Attributes** (inherited from Report):

```
- id: int
- reportType: String
```

**Specific Attributes**:

```
- electricityConsumption: double
- electricityGeneration: double
```

**Methods**:

```
+ calculateCarbonFootprint(...): double
+ generateHotspotMap(...): Map
+ generateCarbonVsConsumptionChart(): Chart
```

**Inherited Methods**:

```
+ exportReport(): void
+ filterReport(...): void
```

**Relationships**:

- Inheritance: `ElectricityReport --|> Report : is-a`
- Calculated by: `CarbonFootprint "1" --> "1" ElectricityReport : calculates`

---

### 6. Dashboard Class

**Package**: User Interface

**Attributes**:

```
- id: int
- dashboardType: String
```

**Methods**:

```
+ generateView(user, type): DashboardView
+ filterByPermissions(user): List
```

**Relationships**:

- Composition: `UI "1" *-- "*" Dashboard : displays`
- Uses: `Dashboard --> Visualizer : uses`
- Aggregation: `Dashboard --> Report : aggregates`
- Dependency: `Dashboard ..> AccessControl : checks permission`

---

### 7. Visualizer Class

**Package**: Visualization

**Attributes**:

```
- id: int
- visualizeType: String
```

**Methods**:

```
+ generateGraph(...): void
+ calculateSelfSufficiency(...): double
+ renderHotspotMap(...): Map
+ renderHeatMap(...): Map
+ renderWeatherWidget(...): Widget
```

**Relationships**:

- Visualizes: `Visualizer --> Report : visualizes`
- Used by: `Dashboard --> Visualizer : uses`

---

### 8. Forecast Class

**Package**: Reporting System

**Attributes**:

```
- id: int
```

**Methods**:

```
+ generateForecast(...): DataSet
```

**Relationships**:

- Generates: `Forecast --> Report : generates`

---

### 9. PeriodComparison Class

**Package**: Analytics

**Attributes**:

```
- id: int
```

**Methods**:

```
+ comparePoP(currentPeriod): double
+ compareYoY(currentPeriod): double
+ compareCustom(period1, period2): double
```

**Relationships**:

- Compares: `Report --> PeriodComparison : compares`

---

### 10. UI Class

**Package**: User Interface

**Attributes**:

```
- currentView: String
```

**Methods**:

```
+ renderView(...): void
+ updateUI(...): void
+ displayWarning(...): void
```

**Relationships**:

- Composition: `UI "1" *-- "*" Dashboard : displays`
- Composition: `UI "1" *-- "1" Filter : owns`
- Composition: `UI "1" *-- "1" ReportCustomization : owns`
- Composition: `UI "1" *-- "1" CarbonFootprint : owns`
- Aggregation: `UI "1" o-- "*" Report : displays`
- Dependency: `UI ..> AccessControl : checks permission`
- Used by: `User --> UI : uses`

---

### 11. Filter Class

**Package**: User Interface

**Attributes**:

```
- id: int
- location: String
- area: String
- timePeriod: String
```

**Methods**:

```
+ applyFilter(): DataSet
+ resetToDefault(): void
```

---

### 12. ReportCustomization Class

**Package**: User Interface

**Attributes**:

```
- id: int
- includeGraphs: List
```

**Methods**:

```
+ preview(): ReportPreview
+ download(...): void
```

---

### 13. AccessControl Class

**Package**: Security

**Methods**:

```
+ checkPermission(user, module): boolean
+ updateUserPermissions(userId, permissions): void
```

**Relationships**:

- Used by: `Admin ..> AccessControl : uses`
- Depended on: `UI ..> AccessControl : checks permission`
- Depended on: `Dashboard ..> AccessControl : checks permission`
- Depended on: `Report ..> AccessControl : checks permission`

---

### 14. Database Interface

**Package**: Data Layer

**Methods**:

```
+ executeQuery(...): DataSet
+ fetchSensorData(): DataSet
```

**Relationships**:

- Queried by: `Report ..> Database : queries`

---

## Database Design

### Table Structure Based on ERD Diagram and Class Diagram

Reference Document: `instructions/ref/erd-diagram.puml`

### 1. USERS Table

```sql
CREATE TABLE USERS (
    id INT PRIMARY KEY IDENTITY(1,1),
    firstName NVARCHAR(100) NOT NULL,
    lastName NVARCHAR(100) NOT NULL,
    email NVARCHAR(255) NOT NULL UNIQUE,
    password NVARCHAR(255) NOT NULL,
    role NVARCHAR(50) NOT NULL CHECK (role IN ('Admin', 'TeamMember')),
    promptChat INT NULL,  -- Only for TeamMember
    permissions NVARCHAR(MAX) NULL,  -- JSON format, only for TeamMember
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

### 2. REPORTS Table (Base Table)

```sql
CREATE TABLE REPORTS (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    report_type NVARCHAR(50) NOT NULL CHECK (report_type IN ('Water', 'Electricity', 'Thermal')),
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

### 3. ELECTRICITY_REPORTS Table

```sql
CREATE TABLE ELECTRICITY_REPORTS (
    id INT PRIMARY KEY FOREIGN KEY REFERENCES REPORTS(id),
    electricityConsumption DECIMAL(10,2) NOT NULL,
    electricityGeneration DECIMAL(10,2) NOT NULL,
    carbonFootprint DECIMAL(10,2) NULL,  -- Associated carbon footprint calculation result
    selfSufficiency DECIMAL(5,2) NULL
);
```

### 4. CARBON_FOOTPRINT Table (Independent Table Design)

```sql
CREATE TABLE CARBON_FOOTPRINT (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    report_id INT NULL FOREIGN KEY REFERENCES ELECTRICITY_REPORTS(id),  -- Optional, for linking electricity reports
    co2Emission DECIMAL(10,2) NOT NULL,
    calculation_source NVARCHAR(50) NOT NULL CHECK (calculation_source IN ('database', 'user_upload')),  -- Calculation source
    created_at DATETIME DEFAULT GETDATE(),
    updated_at DATETIME DEFAULT GETDATE()
);
```

**Design Notes**:

- `user_id`: Links to user
- `report_id`: Optional, for linking electricity reports (Mode 1: automatic calculation from database)
- `calculation_source`: Identifies data source
  - 'database': Automatically calculated from database electricity data
  - 'user_upload': User temporary upload (actually not stored in database, this field for future extension)
- Independent table design follows database normalization principles

### 5. BILL_ENTRY Table

```sql
CREATE TABLE BILL_ENTRY (
    id INT PRIMARY KEY IDENTITY(1,1),
    carbonFootprintId INT NOT NULL FOREIGN KEY REFERENCES CARBON_FOOTPRINT(id),
    year INT NOT NULL,
    month NVARCHAR(20) NOT NULL,
    electricityUsage DECIMAL(10,2) NOT NULL,
    created_at DATETIME DEFAULT GETDATE()
);
```

**Design Notes**:

- Stores user's electricity bill entries
- Base data for carbon footprint calculation
- Supports historical data tracking

### 6. HISTORY_LOGS Table

```sql
CREATE TABLE HISTORY_LOGS (
    id INT PRIMARY KEY IDENTITY(1,1),
    user_id INT NOT NULL FOREIGN KEY REFERENCES USERS(id),
    log_type NVARCHAR(50) NOT NULL CHECK (log_type IN ('report', 'ai_query')),
    timestamp DATETIME DEFAULT GETDATE(),
    details NVARCHAR(MAX) NULL
);
```

### 7. REPORT_HISTORY Table

```sql
CREATE TABLE REPORT_HISTORY (
    id INT PRIMARY KEY FOREIGN KEY REFERENCES HISTORY_LOGS(id),
    report_id INT NOT NULL FOREIGN KEY REFERENCES REPORTS(id),
    filter_location NVARCHAR(100) NULL,
    filter_area NVARCHAR(100) NULL,
    filter_time_period NVARCHAR(100) NULL
);
```

### Test Data Scripts

```sql
-- Insert test users
INSERT INTO USERS (firstName, lastName, email, password, role) VALUES
('Admin', 'User', 'admin@sait.ca', '$2b$10$hashedpassword', 'Admin'),
('John', 'Doe', 'john.doe@sait.ca', '$2b$10$hashedpassword', 'TeamMember');

-- Insert test carbon footprint data
INSERT INTO CARBON_FOOTPRINT (user_id, co2Emission, calculation_source) VALUES (2, 1250.50, 'database');

-- Insert test bill entries
INSERT INTO BILL_ENTRY (carbonFootprintId, year, month, electricityUsage) VALUES
(1, 2024, 'January', 500.0),
(1, 2024, 'February', 450.0),
(1, 2024, 'March', 480.0);

-- Insert test reports
INSERT INTO REPORTS (user_id, report_type) VALUES (2, 'Electricity');

-- Insert test electricity reports
INSERT INTO ELECTRICITY_REPORTS (id, electricityConsumption, electricityGeneration, carbonFootprint) 
VALUES (1, 2500.0, 1800.0, 1250.50);
```

---

## Backend Implementation

### Project Structure

```
backend/
├── src/
│   ├── models/           # Model classes corresponding to class diagram
│   │   ├── User.js
│   │   ├── Admin.js
│   │   ├── TeamMember.js
│   │   ├── CarbonFootprint.js
│   │   ├── BillEntry.js
│   │   ├── Report.js
│   │   ├── ElectricityReport.js
│   │   ├── Dashboard.js
│   │   ├── Visualizer.js
│   │   ├── Forecast.js
│   │   ├── PeriodComparison.js
│   │   ├── Filter.js
│   │   ├── ReportCustomization.js
│   │   └── AccessControl.js
│   ├── controllers/      # Controllers
│   │   ├── authController.js
│   │   ├── carbonFootprintController.js
│   │   ├── electricityReportController.js
│   │   └── dashboardController.js
│   ├── routes/           # Route definitions
│   │   ├── auth.js
│   │   ├── carbonFootprint.js
│   │   ├── electricityReport.js
│   │   └── dashboard.js
│   ├── middleware/       # Middleware
│   │   ├── auth.js
│   │   └── errorHandler.js
│   ├── config/           # Configuration
│   │   └── database.js
│   └── app.js            # Main application
├── package.json
└── .env
```

### Core Class Implementation Examples

#### User Class (Abstract Class)

```javascript
// models/User.js
class User {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.firstName = '';
    this.lastName = '';
    this.email = '';
    this.password = '';
    this.role = '';
  }

  // Methods from class diagram
  async createUser(id, firstName, lastName, email, password, role) {
    this.id = id;
    this.firstName = firstName;
    this.lastName = lastName;
    this.email = email;
    this.password = password;
    this.role = role;
    // Database operation
  }

  async login(email, password) {
    // Validation logic
    // Return user object
  }

  async logout() {
    // Logout logic
  }
}

module.exports = User;
```

#### CarbonFootprint Class (Supporting Two Modes)

```javascript
// models/CarbonFootprint.js
class CarbonFootprint {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.co2Emission = 0.0;
    this.billEntries = [];  // List of BillEntry objects
    this.calculationSource = 'database';  // 'database' or 'user_upload'
  }

  // Methods from class diagram
  async calculateFootprint(electricityUsage, emissionFactor) {
    // Calculate: CO2 = electricity × emission factor
    // Standard emission factor: 0.5 kg CO2/kWh
    this.co2Emission = electricityUsage * emissionFactor;
    return this.co2Emission;  // Returns double
  }

  async addBillEntry(year, month, electricityUsage, persist = true) {
    const billEntry = new BillEntry();
    billEntry.year = year;
    billEntry.month = month;
    billEntry.electricityUsage = electricityUsage;
    this.billEntries.push(billEntry);
  
    // Decide whether to save to database based on persist parameter
    if (persist) {
      // Mode 1: Save to database
      await this.saveBillEntryToDatabase(billEntry);
    }
    // Mode 2: Only save in memory, not persisted
  }

  async overrideWithDIY() {
    // DIY data override logic - user temporary upload mode
    // Set as temporary data, not persisted
    this.calculationSource = 'user_upload';
    return {};  // Returns DataSet
  }
}

module.exports = CarbonFootprint;
```

#### BillEntry Class

```javascript
// models/BillEntry.js
class BillEntry {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.year = 0;
    this.month = '';
    this.electricityUsage = 0.0;
  }
}

module.exports = BillEntry;
```

#### ElectricityReport Class

```javascript
// models/ElectricityReport.js
const Report = require('./Report');

class ElectricityReport extends Report {
  constructor() {
    super();
    // Inherited attributes
    this.reportType = 'Electricity';
  
    // Specific attributes from class diagram
    this.electricityConsumption = 0.0;
    this.electricityGeneration = 0.0;
  }

  // Methods from class diagram
  async calculateCarbonFootprint(emissionFactor) {
    // Key: Call CarbonFootprint class for calculation
    const carbonFootprint = this.electricityConsumption * emissionFactor;
    return carbonFootprint;  // Returns double
  }

  async generateHotspotMap(data) {
    // Generate hotspot map logic
    return {};  // Returns Map
  }

  async generateCarbonVsConsumptionChart() {
    // Generate chart data
    return {
      labels: [],
      carbonData: [],
      consumptionData: []
    };  // Returns Chart
  }

  // Inherited methods from Report
  // exportReport() and filterReport() are inherited
}

module.exports = ElectricityReport;
```

#### Report Base Class

```javascript
// models/Report.js
class Report {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.reportType = '';
  }

  // Methods from class diagram
  async exportReport() {
    // Export report logic
  }

  async filterReport(filters) {
    // Filter report logic
  }
}

module.exports = Report;
```

#### Dashboard Class

```javascript
// models/Dashboard.js
const AccessControl = require('./AccessControl');

class Dashboard {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.dashboardType = '';
  }

  // Methods from class diagram
  async generateView(user, type) {
    // Check permission (Dashboard ..> AccessControl)
    const hasPermission = await AccessControl.checkPermission(user, 'dashboard');
    if (!hasPermission) {
      throw new Error('Permission denied');
    }

    // Generate view
    return {
      dashboardType: type,
      data: {}
    };  // Returns DashboardView
  }

  async filterByPermissions(user) {
    // Filter data based on user permissions
    return [];  // Returns List
  }
}

module.exports = Dashboard;
```

#### AccessControl Class

```javascript
// models/AccessControl.js
class AccessControl {
  // Static methods from class diagram
  static async checkPermission(user, module) {
    // Check user permission based on role
    if (user.role === 'Admin') {
      return true;
    }
  
    if (user.role === 'TeamMember') {
      // Check permissions list
      return user.permissions && user.permissions.includes(module);
    }
  
    return false;  // Returns boolean
  }

  static async updateUserPermissions(userId, permissions) {
    // Update user permissions in database
    // Returns void
  }
}

module.exports = AccessControl;
```

### API Endpoint Design (Strictly Corresponding to Class Diagram Methods)

#### 1. User Authentication API

```javascript
// routes/auth.js
POST /api/user/create      // User.createUser()
POST /api/user/login       // User.login()
POST /api/user/logout      // User.logout()
```

#### 2. CarbonFootprint API

```javascript
// routes/carbonFootprint.js
GET  /api/carbon-footprint/:id              // Get carbon footprint data
POST /api/carbon-footprint/calculate        // CarbonFootprint.calculateFootprint()
POST /api/carbon-footprint/bill-entry       // CarbonFootprint.addBillEntry()
PUT  /api/carbon-footprint/override         // CarbonFootprint.overrideWithDIY()
```

#### 3. ElectricityReport API

```javascript
// routes/electricityReport.js
GET  /api/electricity/report/:id                    // Get electricity report
POST /api/electricity/report/create                 // Create electricity report
POST /api/electricity/report/calculate-carbon       // ElectricityReport.calculateCarbonFootprint()
GET  /api/electricity/report/hotspot-map/:id        // ElectricityReport.generateHotspotMap()
GET  /api/electricity/report/carbon-chart/:id       // ElectricityReport.generateCarbonVsConsumptionChart()
POST /api/electricity/report/export/:id             // Report.exportReport()
POST /api/electricity/report/filter                 // Report.filterReport()
```

#### 4. Dashboard API

```javascript
// routes/dashboard.js
GET /api/dashboard/view                    // Dashboard.generateView()
GET /api/dashboard/filter-permissions      // Dashboard.filterByPermissions()
```

---

## Frontend Implementation

### Project Structure

```
frontend/
├── src/
│   ├── components/       # React components
│   │   ├── Login/
│   │   │   └── LoginPage.jsx
│   │   ├── Dashboard/
│   │   │   ├── DashboardLayout.jsx
│   │   │   └── ElectricityDashboard.jsx
│   │   ├── CarbonFootprint/
│   │   │   └── CarbonFootprintPage.jsx
│   │   └── Common/
│   │       ├── Header.jsx
│   │       ├── Sidebar.jsx
│   │       └── Chart.jsx
│   ├── services/         # API services (corresponding to class diagram classes)
│   │   ├── UserService.js
│   │   ├── CarbonFootprintService.js
│   │   ├── ElectricityReportService.js
│   │   ├── DashboardService.js
│   │   └── VisualizerService.js
│   ├── contexts/         # React Context (state management)
│   │   ├── AuthContext.jsx
│   │   └── UIContext.jsx
│   ├── utils/            # Utility functions
│   │   └── api.js
│   ├── App.js
│   └── index.js
├── package.json
└── .env
```

### Frontend Service Classes (Corresponding to Class Diagram)

#### UserService.js

```javascript
// services/UserService.js
import api from '../utils/api';

class UserService {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.firstName = '';
    this.lastName = '';
    this.email = '';
    this.password = '';
    this.role = '';
  }

  // Methods from class diagram
  async createUser(id, firstName, lastName, email, password, role) {
    const response = await api.post('/api/user/create', {
      id, firstName, lastName, email, password, role
    });
    return response.data;
  }

  async login(email, password) {
    const response = await api.post('/api/user/login', { email, password });
    const user = response.data;
  
    // Store user data
    this.id = user.id;
    this.firstName = user.firstName;
    this.lastName = user.lastName;
    this.email = user.email;
    this.role = user.role;
  
    return user;
  }

  async logout() {
    await api.post('/api/user/logout');
    // Clear user data
    this.id = null;
    this.firstName = '';
    this.lastName = '';
    this.email = '';
    this.role = '';
  }
}

export default new UserService();
```

#### CarbonFootprintService.js

```javascript
// services/CarbonFootprintService.js
import api from '../utils/api';

class CarbonFootprintService {
  constructor() {
    // Attributes from class diagram
    this.id = null;
    this.co2Emission = 0.0;
    this.billEntries = [];
  }

  // Methods from class diagram
  async calculateFootprint(electricityUsage, emissionFactor) {
    const response = await api.post('/api/carbon-footprint/calculate', {
      electricityUsage,
      emissionFactor
    });
    this.co2Emission = response.data.co2Emission;
    return this.co2Emission;  // Returns double
  }

  async addBillEntry(year, month, electricityUsage) {
    const response = await api.post('/api/carbon-footprint/bill-entry', {
      year, month, electricityUsage
    });
    return response.data;
  }

  async overrideWithDIY() {
    const response = await api.put('/api/carbon-footprint/override');
    return response.data;  // Returns DataSet
  }
}

export default new CarbonFootprintService();
```

### React Component Implementation

#### LoginPage.jsx

```jsx
// components/Login/LoginPage.jsx
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import UserService from '../../services/UserService';

const LoginPage = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const navigate = useNavigate();

  const handleLogin = async (e) => {
    e.preventDefault();
    try {
      // Call User.login() method from class diagram
      const user = await UserService.login(email, password);
    
      // Store user info (all User attributes)
      localStorage.setItem('user', JSON.stringify({
        id: user.id,
        firstName: user.firstName,
        lastName: user.lastName,
        email: user.email,
        role: user.role
      }));
    
      // Navigate based on role
      if (user.role === 'Admin') {
        navigate('/admin/dashboard');
      } else {
        navigate('/dashboard');
      }
    } catch (err) {
      setError('Invalid email or password');
    }
  };

  return (
    <div className="login-container">
      <h1>EcoSphere Login</h1>
      <form onSubmit={handleLogin}>
        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} required />
        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required />
        {error && <div className="error">{error}</div>}
        <button type="submit">Login</button>
      </form>
    </div>
  );
};

export default LoginPage;
```

---

## Implementation Steps (Adjusted by Priority)

### Phase 1: Environment Setup (1-2 hours) - 🔴 P0

**Task Checklist**:

- [ ] Initialize React project (`npx create-react-app frontend` or `npm create vite@latest`)
- [ ] Initialize Node.js backend project (`npm init -y`)
- [ ] Install backend dependencies: express, mssql, bcrypt, jsonwebtoken, cors, dotenv
- [ ] Install frontend dependencies: react-router-dom, axios, chart.js, react-chartjs-2
- [ ] Configure SQL Server connection
- [ ] Create basic project structure (following directory structure above)
- [ ] Configure .env file (database connection, JWT secret, etc.)
- [ ] Create UIContext (React implementation of UI class)

**Reference**: CaseStudy Week 1-2 tasks

---

### Phase 2: Database Design (1 hour) - 🔴 P0

**Task Checklist**:

- [ ] Create database tables based on ERD diagram
- [ ] Create USERS table
- [ ] Create CARBON_FOOTPRINT table (independent table, includes calculation_source field)
- [ ] Create BILL_ENTRY table
- [ ] Create REPORTS table (Skeleton)
- [ ] Create ELECTRICITY_REPORTS table (Skeleton)
- [ ] Create HISTORY_LOGS table (Skeleton)
- [ ] Create REPORT_HISTORY table (Skeleton)
- [ ] Insert test data (at least 2 users: 1 Admin, 1 TeamMember)
- [ ] Insert test carbon footprint data and bill entries
- [ ] Verify table relationships and foreign key constraints

**Reference**: instructions/ref/erd-diagram.puml

---

### Phase 3: Backend API Development - P0 Core Features (4-5 hours)

#### 3.1 User Authentication & Management Module (2 hours) - 🔴 P0

- [ ] Implement User class (models/User.js)
- [ ] Implement Admin class (inherits User, includes addUser, editUserPermissions, assignRole methods)
- [ ] Implement TeamMember class (inherits User)
- [ ] Implement AccessControl class
- [ ] Create authentication middleware (JWT verification)
- [ ] Implement POST /api/user/login - User.login()
- [ ] Implement POST /api/user/logout - User.logout()
- [ ] **Implement POST /api/user/create - Admin.addUser()** (no registration feature)
- [ ] **Implement PUT /api/user/:id - Admin.editUser()**
- [ ] **Implement PUT /api/user/:id/permissions - Admin.editUserPermissions()**
- [ ] **Implement GET /api/users - Admin get user list**
- [ ] Test login flow and user management functionality

#### 3.2 CarbonFootprint Module (Two Modes) (2 hours) - 🔴 P0

- [ ] Implement CarbonFootprint class (models/CarbonFootprint.js)
  - [ ] Support database automatic calculation mode
  - [ ] Support user temporary upload mode
- [ ] Implement BillEntry class (models/BillEntry.js)
- [ ] Implement GET /api/carbon-footprint/:userId - Get user carbon footprint
- [ ] Implement POST /api/carbon-footprint/calculate-from-db - Calculate from database
- [ ] Implement POST /api/carbon-footprint/calculate-from-upload - Temporary upload calculation (not persisted)
- [ ] Implement POST /api/carbon-footprint/bill-entry - addBillEntry()
- [ ] Implement GET /api/carbon-footprint/:userId/history - Get historical data
- [ ] Test both modes of carbon footprint calculation logic

#### 3.3 Skeleton Class Implementation (0.5-1 hour) - 🟢 P2

- [ ] Implement Report base class (models/Report.js) - Skeleton
- [ ] Implement ElectricityReport class (inherits Report) - Skeleton
- [ ] Implement Dashboard class (models/Dashboard.js) - Skeleton
- [ ] Implement Visualizer class (models/Visualizer.js) - Skeleton
- [ ] Implement Forecast class (models/Forecast.js) - Skeleton (marked for future implementation)
- [ ] Implement PeriodComparison class (models/PeriodComparison.js) - Skeleton

**Reference**:

- class-diagram-optimized.puml
- CaseStudy Week 3-5 tasks

---

### Phase 4: Frontend Development - P0 Core Features (5-6 hours)

#### 4.1 Basic Setup (1 hour) - 🔴 P0

- [ ] Create API utility class (utils/api.js)
- [ ] Configure Axios interceptors (add JWT token)
- [ ] Create UIContext (UI class implementation)
- [ ] Create all Service classes (corresponding to class diagram)
- [ ] Configure React Router
- [ ] Create basic layout components (Header, Sidebar)

#### 4.2 Login Page (1 hour) - 🔴 P0

- [ ] Create LoginPage component
- [ ] Implement form validation
- [ ] Call UserService.login()
- [ ] Store user information (includes all User attributes)
- [ ] Implement role-based routing (Admin → User Management, TeamMember → Dashboard)
- [ ] Test login flow

#### 4.3 User Management Page (Admin Only) (1.5 hours) - 🔴 P0

- [ ] Create UserManagementPage component (Admin only)
- [ ] Display user list
- [ ] Implement add user functionality (Admin.addUser())
- [ ] Implement edit user functionality (Admin.editUser())
- [ ] Implement assign permissions functionality (Admin.editUserPermissions())
- [ ] Implement role assignment (Admin.assignRole())
- [ ] Permission check (only Admin can access)
- [ ] Test user management flow

#### 4.4 Carbon Footprint Page (Two Modes) (2 hours) - 🔴 P0

- [ ] Create CarbonFootprintPage component
- [ ] **Mode 1: Database Automatic Calculation**
  - [ ] Display carbon footprint data calculated from database
  - [ ] Display historical carbon footprint trend charts
  - [ ] Display BillEntry list
- [ ] **Mode 2: User Temporary Upload**
  - [ ] Create upload form (year, month, electricity usage)
  - [ ] Real-time carbon footprint calculation (not persisted)
  - [ ] Display calculation results
  - [ ] Add note: data will not be saved
- [ ] Mode switching functionality (Tab or button)
- [ ] Visualize data using Chart.js
- [ ] Test both modes of carbon footprint calculation

#### 4.5 Skeleton Pages (Framework Setup) (0.5-1 hour) - 🟢 P2

- [ ] Create ElectricityDashboardPage component (Skeleton)
- [ ] Create WaterDashboardPage component (Skeleton)
- [ ] Create ThermalDashboardPage component (Skeleton)
- [ ] Add navigation links (temporarily display "Coming Soon")

**Reference**:

- Figma design: instructions/ref/figma/
- CaseStudy Week 7-9 tasks

---

### Phase 5: P1 Features (If Time Allows) - Electricity Dashboard Basic Version (3-4 hours)

#### 5.1 ElectricityReport Backend (1.5 hours) - 🟡 P1

- [ ] Complete ElectricityReport class implementation
- [ ] Implement GET /api/electricity/report/:userId
- [ ] Implement POST /api/electricity/report/calculate-carbon
- [ ] Implement GET /api/electricity/report/carbon-chart/:userId
- [ ] Ensure ElectricityReport links with CarbonFootprint data

#### 5.2 Electricity Dashboard Frontend (2 hours) - 🟡 P1

- [ ] Complete ElectricityDashboardPage component
- [ ] Display electricity consumption and generation data
- [ ] **Integrate carbon footprint data display**
- [ ] Implement basic chart visualization
- [ ] Calculate self-sufficiency rate
- [ ] Test complete flow

---

### Phase 6: Integration & Testing (2-3 hours) - 🔴 P0

#### 6.1 Frontend-Backend Integration (1 hour)

- [ ] Test login flow (Admin and TeamMember)
- [ ] Test user management flow (Admin add/edit users)
- [ ] Test carbon footprint calculation flow (both modes)
- [ ] Test permission control (Admin vs TeamMember)
- [ ] Fix API call issues

#### 6.2 Functional Testing (1 hour)

- [ ] Test User.login() and logout()
- [ ] Test Admin.addUser() and editUserPermissions()
- [ ] Test CarbonFootprint.calculateFootprint() (both modes)
- [ ] Test CarbonFootprint.addBillEntry()
- [ ] Test AccessControl.checkPermission()
- [ ] Test data persistence (Mode 1) and temporary data (Mode 2)

#### 6.3 UI/UX Optimization (1 hour)

- [ ] Add loading states (using UIContext)
- [ ] Add error handling (using UI.displayWarning())
- [ ] Optimize chart display
- [ ] Responsive design adjustments
- [ ] Add user feedback prompts

**Reference**: CaseStudy Week 11-12 tasks

---

## Class Diagram Relationship Checklist

### Must Implement Inheritance Relationships

- [ ] `Admin --|> User` : Admin inherits User
- [ ] `TeamMember --|> User` : TeamMember inherits User
- [ ] `ElectricityReport --|> Report` : ElectricityReport inherits Report

### Must Implement Composition Relationships (Strong Ownership)

- [ ] `UI "1" *-- "*" Dashboard` : UI composes Dashboard
- [ ] `UI "1" *-- "1" Filter` : UI composes Filter
- [ ] `UI "1" *-- "1" ReportCustomization` : UI composes ReportCustomization
- [ ] `UI "1" *-- "1" CarbonFootprint` : UI composes CarbonFootprint
- [ ] `CarbonFootprint "1" o-- "*" BillEntry` : CarbonFootprint contains BillEntry

### Must Implement Aggregation Relationships (Weak Ownership)

- [ ] `UI "1" o-- "*" Report` : UI aggregates Report
- [ ] `User "1" o-- "*" HistoryLog` : User generates HistoryLog

### Must Implement Dependency Relationships

- [ ] `CarbonFootprint "1" --> "1" ElectricityReport` : CarbonFootprint calculates ElectricityReport
- [ ] `Dashboard --> Visualizer` : Dashboard uses Visualizer
- [ ] `Dashboard --> Report` : Dashboard aggregates Report
- [ ] `Dashboard ..> AccessControl` : Dashboard checks permissions
- [ ] `Visualizer --> Report` : Visualizer visualizes Report
- [ ] `Forecast --> Report` : Forecast generates Report
- [ ] `Report --> PeriodComparison` : Report compares PeriodComparison
- [ ] `Report ..> Database` : Report queries Database
- [ ] `Report ..> AccessControl` : Report checks permissions
- [ ] `User --> UI` : User uses UI
- [ ] `Admin ..> AccessControl` : Admin uses AccessControl

### Key Integration Point Verification

- [ ] Electricity reports display carbon footprint data
- [ ] ElectricityReport calls CarbonFootprint.calculateFootprint()
- [ ] Dashboard calls AccessControl.checkPermission()
- [ ] Report calls Database.executeQuery()
- [ ] Visualizer generates chart data

---

## Reference Documents

### Phase 3 Requirements Documents

- **Main Document**: `instructions/Phase3_extracted.md`
  - Prototype requirements: Login + Carbon Footprint (non-trivial) + Electricity Dashboard
  - Submission requirements: Source code + Demo

### Phase 2 Design Documents

- **Main Document**: `instructions/ref/Phase2_extracted.md`
  - Use Case descriptions (Page 11-22)
  - Functional and non-functional requirements (Page 5-6)
  - Data storage and persistence (Page 8-9)
  - UI design (Page 24-36)

### Case Study and Project Management

- **Main Document**: `instructions/ref/CaseStudy_extracted.md`
  - Work Breakdown Structure (WBS)
  - Task dependencies
  - Time estimation
  - Milestone definitions

### UML Diagrams

#### Class Diagram (Most Important - Must Strictly Follow)

- **File**: `instructions/ref/class-diagram-optimized.puml`
- **Purpose**: All class attributes and methods definitions
- **Key Packages**: User Management, Reporting System, Carbon Analysis, User Interface, Visualization, Analytics

#### ERD Diagram

- **File**: `instructions/ref/erd-diagram.puml`
- **Purpose**: Database table structure design
- **Key Tables**: USERS, REPORTS, ELECTRICITY_REPORTS, CARBON_FOOTPRINT, BILL_ENTRY

#### Deployment Diagram

- **File**: `instructions/ref/deployment-diagram.puml`
- **Purpose**: System architecture and technology stack
- **Architecture**: Three-tier architecture (Presentation, Application, Data Layer)

#### Use Case Diagram

- **File**: `instructions/ref/usecase-diagram.puml`
- **Purpose**: System functionality overview
- **Key Use Cases**: Login, View Dashboard, Carbon Footprint Calculation

#### Sequence Diagrams (Newly Completed)

- **Electricity Dashboard**: `deliverables/seq-electricity-dashboard.puml`
  - Real-time mode vs time period selection mode
  - Forecast and period comparison flow
  - Report export flow
- **AI Chatbot**: `deliverables/seq-ai-chatbot.puml`
  - Natural language query processing
  - Permission check flow
  - Error handling flow
- **Quiz Management**: `deliverables/seq-quiz-management.puml`
  - Admin creates quiz
  - QR code generation
  - Results viewing

#### Activity Diagrams (Newly Completed)

- **Electricity Dashboard**: `deliverables/activity-electricity-dashboard.puml`
  - User interaction flow
  - Data loading and visualization
  - Report export decision points
- **AI Chatbot**: `deliverables/activity-ai-chatbot.puml`
  - Query processing flow
  - Permission verification
  - Error handling branches

### UI Design

- **Figma Exports**: `instructions/ref/figma/` folder
  - Admin interface design
  - Team member interface design
  - Report export interface: export report 1-4.png
  - Dashboard layout reference

---

## Minimum Viable Product (MVP) Feature List (Updated Version)

### 🔴 P0 (Must Implement - Prototype Demo Core)

#### Login & User Management Module

- [ ] User class and its login/logout methods
- [ ] Admin class (inherits User) and its user management methods
  - [ ] addUser() - Add new user
  - [ ] editUserPermissions() - Edit permissions
  - [ ] assignRole() - Assign role
- [ ] TeamMember class (inherits User) and its getPermissions() method
- [ ] AccessControl permission checking
- [ ] JWT token generation and verification
- [ ] Login page UI
- [ ] **User Management page UI (Admin only)**
  - [ ] User list display
  - [ ] Add user form
  - [ ] Edit user form
  - [ ] Permission assignment interface
- [ ] Role-based routing (Admin → User Management, TeamMember → Dashboard)
- [ ] **Important**: No registration feature, all users created by Admin

#### Carbon Footprint Module (Two Modes)

- [ ] CarbonFootprint class and its methods
  - [ ] calculateFootprint() - Calculate carbon footprint
  - [ ] addBillEntry() - Add bill entry
  - [ ] calculateFromDatabase() - Mode 1: Database automatic calculation
  - [ ] calculateFromUserUpload() - Mode 2: User temporary upload
  - [ ] overrideWithDIY() - DIY data override
- [ ] BillEntry class
- [ ] Carbon footprint page UI
  - [ ] **Mode 1**: Database automatic calculation display
    - [ ] Display historical carbon footprint data
    - [ ] Display bill entry list
    - [ ] Data persistence
  - [ ] **Mode 2**: User temporary upload
    - [ ] Upload form (year, month, electricity usage)
    - [ ] Real-time calculation display
    - [ ] Data not persisted notification
  - [ ] Mode switching functionality
  - [ ] Basic chart visualization
- [ ] Independent CARBON_FOOTPRINT database table

#### UI Class Implementation

- [ ] UIContext (using React Context API)
- [ ] UI class attributes and methods
  - [ ] currentView
  - [ ] renderView()
  - [ ] updateUI()
  - [ ] displayWarning()
- [ ] Composition relationship implementation
  - [ ] UI owns Dashboard
  - [ ] UI owns Filter
  - [ ] UI owns ReportCustomization
  - [ ] UI owns CarbonFootprint

#### Class Diagram Relationships (Core)

- [ ] All inheritance relationships implemented (Admin/TeamMember → User)
- [ ] UI class composition relationships
- [ ] AccessControl dependency relationships

---

### 🟡 P1 (Implement If Time Allows - Enhanced Demo Effect)

#### Electricity Dashboard Module (Basic Version)

- [ ] ElectricityReport class and its calculateCarbonFootprint method
- [ ] Report base class (Skeleton)
- [ ] Dashboard class and its generateView method
- [ ] Visualizer class and its calculateSelfSufficiency method
- [ ] Electricity dashboard page UI
  - [ ] Display electricity consumption and generation data
  - [ ] **Integrate carbon footprint data display**
  - [ ] Basic chart visualization
  - [ ] Self-sufficiency rate calculation
- [ ] Basic data filtering functionality

---

### 🟢 P2 (Skeleton Implementation - Framework Only)

#### Other Report Modules

- [ ] WaterReport class (Skeleton)
- [ ] ThermalReport class (Skeleton)
- [ ] Placeholder pages

#### Advanced Features

- [ ] Forecast class (Skeleton) - Prediction functionality
- [ ] PeriodComparison class (Skeleton) - Period comparison
- [ ] Filter class (Skeleton) - Data filtering
- [ ] ReportCustomization class (Skeleton) - Report customization
- [ ] 3D visualization (Skeleton)

**Note**: P2 features only implement framework structure, actual functionality to be implemented in future versions

---

## Detailed Implementation Plan

### Week 1-2: Core Foundation (P0)

#### Day 1-2: Environment & Database

- Set up development environment
- Create database tables
- Insert test data
- Configure backend project structure

#### Day 3-4: User Authentication

- Implement User, Admin, TeamMember classes
- Implement login/logout API
- Create login page
- Test authentication flow

#### Day 5-6: User Management

- Implement user management API (Admin only)
- Create user management page
- Implement add/edit/delete user functionality
- Test permission control

#### Day 7-8: Carbon Footprint (Mode 1)

- Implement CarbonFootprint class
- Implement database automatic calculation
- Create carbon footprint page
- Implement Chart.js visualization

#### Day 9-10: Carbon Footprint (Mode 2)

- Implement user temporary upload mode
- Create upload form
- Implement real-time calculation (not persisted)
- Test both modes

#### Day 11-12: Integration & Testing

- Frontend-backend integration
- Comprehensive testing
- Bug fixes
- UI/UX optimization

---

### Week 3-4: P1 Features (If Time Allows)

#### Day 13-15: Electricity Dashboard

- Complete ElectricityReport class
- Implement dashboard API
- Create dashboard page
- Integrate carbon footprint display

#### Day 16-18: Advanced Visualization

- Implement Visualizer class
- Add more chart types
- Implement self-sufficiency calculation
- Optimize user experience

---

### Week 5+: P2 Skeleton & Future Features

#### Skeleton Implementation

- Create all P2 class skeletons
- Add TODO comments for future implementation
- Ensure class structure matches class diagram

#### Future Enhancements

- Database migration (Mock data → SQL Server)
- JWT authentication upgrade
- Forecast algorithm implementation
- Period comparison functionality
- 3D visualization
- AI chatbot integration

---

## Detailed Code Implementation Examples

### Backend Implementation Examples

#### User Controller

```javascript
// controllers/userController.js
const UserService = require('../services/userService');

class UserController {
  static async login(req, res) {
    try {
      const { email, password } = req.body;
      const user = await UserService.authenticate(email, password);
    
      if (user) {
        res.json(user);
      } else {
        res.status(401).json({ error: 'Invalid credentials' });
      }
    } catch (error) {
      res.status(500).json({ error: 'Login failed' });
    }
  }

  static async createUser(req, res) {
    try {
      const { firstName, lastName, email, password, role, permissions } = req.body;
    
      if (!firstName || !lastName || !email || !password || !role) {
        return res.status(400).json({ error: 'Missing required fields' });
      }
    
      const newUser = await UserService.createUser({
        firstName, lastName, email, password, role, permissions
      });
    
      res.status(201).json(newUser);
    } catch (error) {
      if (error.message === 'Email already exists') {
        return res.status(400).json({ error: error.message });
      }
      res.status(500).json({ error: 'Failed to create user' });
    }
  }
}

module.exports = UserController;
```

#### Carbon Footprint Controller

```javascript
// controllers/carbonFootprintController.js
const CarbonFootprintService = require('../services/carbonFootprintService');

class CarbonFootprintController {
  static async calculateFromDatabase(req, res) {
    try {
      const { userId } = req.params;
      const result = await CarbonFootprintService.calculateFromDatabase(userId);
      res.json(result);
    } catch (error) {
      res.status(500).json({ error: 'Calculation failed' });
    }
  }

  static async calculateFromUpload(req, res) {
    try {
      const { billEntries } = req.body;
      const result = await CarbonFootprintService.calculateFromUserUpload(billEntries);
      res.json(result);
    } catch (error) {
      res.status(500).json({ error: 'Calculation failed' });
    }
  }

  static async addBillEntry(req, res) {
    try {
      const { year, month, electricityUsage, persist } = req.body;
      const result = await CarbonFootprintService.addBillEntry(year, month, electricityUsage, persist);
      res.json(result);
    } catch (error) {
      res.status(500).json({ error: 'Failed to add bill entry' });
    }
  }
}

module.exports = CarbonFootprintController;
```

### Frontend Implementation Examples

#### UIContext Implementation (UI Class in React)

```javascript
// contexts/UIContext.jsx
import React, { createContext, useContext, useState } from 'react';

class UI {
  constructor() {
    // Attributes from class diagram
    this.currentView = '';
    this.warningMessage = '';
    this.isLoading = false;
  }

  // Methods from class diagram
  renderView(viewName) {
    this.currentView = viewName;
  }

  updateUI(data) {
    console.log('Updating UI with data:', data);
  }

  displayWarning(message) {
    this.warningMessage = message;
  }
}

const UIContext = createContext();

export const UIProvider = ({ children }) => {
  const [ui] = useState(() => new UI());
  const [currentView, setCurrentView] = useState('');
  const [warningMessage, setWarningMessage] = useState('');

  const renderView = (viewName) => {
    ui.renderView(viewName);
    setCurrentView(viewName);
  };

  const displayWarning = (message) => {
    ui.displayWarning(message);
    setWarningMessage(message);
    setTimeout(() => setWarningMessage(''), 5000);
  };

  const value = {
    ui, currentView, warningMessage,
    renderView, displayWarning
  };

  return <UIContext.Provider value={value}>{children}</UIContext.Provider>;
};

export const useUI = () => {
  const context = useContext(UIContext);
  if (!context) {
    throw new Error('useUI must be used within UIProvider');
  }
  return context;
};

export default UIContext;
```

#### CarbonFootprintPage Component (Two Modes)

```jsx
// components/CarbonFootprint/CarbonFootprintPage.jsx
import React, { useState, useEffect } from 'react';
import CarbonFootprintService from '../../services/CarbonFootprintService';
import { Line } from 'react-chartjs-2';

const CarbonFootprintPage = () => {
  const [mode, setMode] = useState('database'); // 'database' or 'upload'
  const [carbonFootprint, setCarbonFootprint] = useState({
    id: null,
    co2Emission: 0,
    billEntries: []
  });
  const [uploadEntries, setUploadEntries] = useState([]);
  const [chartData, setChartData] = useState(null);

  // Mode 1: Load from database
  const loadFromDatabase = async () => {
    const user = JSON.parse(localStorage.getItem('user'));
    const data = await CarbonFootprintService.getCarbonFootprint(user.id);
    setCarbonFootprint(data);
  };

  // Mode 2: Calculate from user upload (not persisted)
  const calculateFromUpload = async () => {
    const totalUsage = uploadEntries.reduce((sum, entry) => sum + entry.electricityUsage, 0);
    const emissionFactor = 0.5;
    const result = await CarbonFootprintService.calculateFootprint(totalUsage, emissionFactor);
    setCarbonFootprint(prev => ({ ...prev, co2Emission: result }));
  };

  return (
    <div className="carbon-footprint-page">
      <h1>Carbon Footprint Tracking</h1>
    
      {/* Mode Selector */}
      <div className="mode-selector">
        <button onClick={() => setMode('database')}>Database Mode</button>
        <button onClick={() => setMode('upload')}>Upload Mode</button>
      </div>

      {/* Mode 1: Database */}
      {mode === 'database' && (
        <div className="database-mode">
          <h2>Historical Data (Persisted)</h2>
          <p>Total CO2 Emission: {carbonFootprint.co2Emission} kg</p>
          {chartData && <Line data={chartData} />}
        </div>
      )}

      {/* Mode 2: Upload */}
      {mode === 'upload' && (
        <div className="upload-mode">
          <h2>Temporary Calculation (Not Persisted)</h2>
          <p className="warning">⚠️ Data will not be saved to database</p>
          {/* Upload form */}
          <button onClick={calculateFromUpload}>Calculate</button>
        </div>
      )}
    </div>
  );
};

export default CarbonFootprintPage;
```

---

## Detailed Implementation Plan

### Week 1-2: Core Foundation (P0)

#### Day 1-2: Environment & Database

- Set up development environment
- Create database tables
- Insert test data
- Configure backend project structure

#### Day 3-4: User Authentication

- Implement User, Admin, TeamMember classes
- Implement login/logout API
- Create login page
- Test authentication flow

#### Day 5-6: User Management

- Implement user management API (Admin only)
- Create user management page
- Implement add/edit/delete user functionality
- Test permission control

#### Day 7-8: Carbon Footprint (Mode 1)

- Implement CarbonFootprint class
- Implement database automatic calculation
- Create carbon footprint page
- Implement Chart.js visualization

#### Day 9-10: Carbon Footprint (Mode 2)

- Implement user temporary upload mode
- Create upload form
- Implement real-time calculation (not persisted)
- Test both modes

#### Day 11-12: Integration & Testing

- Frontend-backend integration
- Comprehensive testing
- Bug fixes
- UI/UX optimization

---

### Week 3-4: P1 Features (If Time Allows)

#### Day 13-15: Electricity Dashboard

- Complete ElectricityReport class
- Implement dashboard API
- Create dashboard page
- Integrate carbon footprint display

#### Day 16-18: Advanced Visualization

- Implement Visualizer class
- Add more chart types
- Implement self-sufficiency calculation
- Optimize user experience

---

### Week 5+: P2 Skeleton & Future Features

#### Skeleton Implementation

- Create all P2 class skeletons
- Add TODO comments for future implementation
- Ensure class structure matches class diagram

#### Future Enhancements

- Database migration (Mock data → SQL Server)
- JWT authentication upgrade
- Forecast algorithm implementation
- Period comparison functionality
- 3D visualization
- AI chatbot integration

---

## Development Notes

### 1. Strict Class Diagram Compliance

- **All classes must include all attributes defined in the class diagram**
- **All methods must be implemented according to signatures in the class diagram**
- **Relationships between classes must be reflected in code**
- **Method naming must be consistent with the class diagram**

### 2. Carbon Footprint Integration

- ElectricityReport must call CarbonFootprint.calculateFootprint()
- Electricity report pages must display both electricity data and carbon footprint data simultaneously
- The association between the two must be clearly visible

### 3. Data Association

- Electricity data and carbon footprint data are linked through user ID
- Calculation formula: Carbon Emission = Electricity Consumption × Emission Factor (0.5 kg CO2/kWh)
- Ensure data consistency

### 4. Permission Control

- All API calls must check permissions first
- Use AccessControl.checkPermission()
- Admin has full permissions, TeamMember based on permissions list

### 5. Error Handling

- Implement basic error handling and user prompts
- Display friendly error messages when API calls fail
- Data validation and boundary checking

### 6. Code Reuse

- Reuse components and API logic as much as possible
- Create reusable chart components
- Unified API call encapsulation

### 7. Test Data

- Prepare sufficient test data to demonstrate functionality
- At least 2 users (Admin and TeamMember)
- At least 3 months of electricity and carbon footprint data

### 8. Performance Considerations

- For prototypes, performance is not the primary concern
- But avoid obvious performance issues
- Reasonable use of loading states

### 9. Documentation and Comments

- Add necessary comments in code
- Explain class diagram correspondence
- Mark key business logic

---

## Estimated Workload (Updated Version)

### Overall Estimate (By Priority)

- **P0 - Must Complete**:

  - Environment setup: 1-2 hours
  - Database design: 1 hour
  - Backend API (Login + User Management + Carbon Footprint): 4-5 hours
  - Frontend development (Login + User Management + Carbon Footprint): 5-6 hours
  - Integration testing: 2-3 hours
  - **P0 Subtotal**: Approximately 13-17 hours
- **P1 - If Time Allows**:

  - Electricity dashboard backend: 1.5 hours
  - Electricity dashboard frontend: 2 hours
  - **P1 Subtotal**: Approximately 3.5 hours
- **P2 - Skeleton**:

  - Skeleton classes and pages: 1-2 hours
  - **P2 Subtotal**: Approximately 1-2 hours
- **Total**: Approximately 17-22 hours (recommend reserving 2-3 hours buffer)

### Estimate by Module (Detailed)

| Module                       | Backend | Frontend | Testing | Total | Priority |
| ---------------------------- | ------- | -------- | ------- | ----- | -------- |
| Environment Setup            | 0.5h    | 0.5h     | 0.5h    | 1.5h  | 🔴 P0    |
| Database Design              | 1h      | -        | 0.5h    | 1.5h  | 🔴 P0    |
| Login                        | 1h      | 1h       | 0.5h    | 2.5h  | 🔴 P0    |
| User Management              | 1h      | 1.5h     | 0.5h    | 3h    | 🔴 P0    |
| Carbon Footprint (Two Modes) | 2h      | 2h       | 1h      | 5h    | 🔴 P0    |
| UI Class Implementation      | -       | 1h       | 0.5h    | 1.5h  | 🔴 P0    |
| Electricity Dashboard        | 1.5h    | 2h       | 1h      | 4.5h  | 🟡 P1    |
| Skeleton                     | 0.5h    | 1h       | 0.5h    | 2h    | 🟢 P2    |

### Weekly Plan

**Week 1** (P0 Core Features):

- Day 1-2: Environment setup + Database design + Login functionality
- Day 3-4: User management functionality
- Day 5-7: Carbon footprint functionality (two modes)

**Week 2** (P1 and Testing):

- Day 1-2: Electricity dashboard (if time allows)
- Day 3-4: Integration testing and bug fixes
- Day 5-7: UI optimization + Demo preparation

**Buffer Time**: Reserve 2-3 hours for unexpected issues

---

## Demo Preparation

### Demo Script (Updated Version)

#### 1. Login Demo (1.5 minutes)

- Show login page
- **First login with Admin account**
- Show Admin redirected to User Management page after login
- Explain User class login() method implementation
- Explain system is internal, no registration feature

#### 2. User Management Demo (2.5 minutes) - 🔴 Core Demo

- Show user list
- **Demo adding new user** (Admin.addUser())
  - Fill in user information (firstName, lastName, email, password)
  - Select role (Admin or TeamMember)
  - Creation successful
- **Demo editing user permissions** (Admin.editUserPermissions())
  - Select TeamMember user
  - Assign permissions (e.g., Electricity, Water permissions)
  - Save successful
- Explain Admin class implementation and inheritance relationship
- Emphasize use of AccessControl.checkPermission()

#### 3. Carbon Footprint Tracking Demo (4 minutes) - 🔴 Core Demo (Non-trivial Use Case)

- Logout Admin, login with TeamMember account
- Navigate to carbon footprint page
- **Mode 1: Database Automatic Calculation**
  - Show carbon footprint data read from database
  - Show historical bill entry list
  - Show carbon footprint trend chart
  - Explain data persistence storage
- **Mode 2: User Temporary Upload**
  - Switch to upload mode
  - Demo uploading electricity bill (year, month, electricity usage)
  - Real-time calculation and display carbon footprint
  - **Emphasize**: Data will not be saved, cleared after closing browser
  - Explain overrideWithDIY() method
- Explain CarbonFootprint class two calculation mode implementation
- Explain advantages of independent table design

#### 4. Electricity Dashboard Demo (2 minutes) - 🟡 If Time Allows

- Navigate to electricity dashboard
- Show electricity consumption and generation data
- **Key demonstration**: Carbon footprint data integration display
- Explain ElectricityReport.calculateCarbonFootprint() call
- Show basic chart visualization
- Show self-sufficiency rate calculation
- Explain Dashboard.generateView() usage

#### 5. UI Class and Class Diagram Correspondence Explanation (2 minutes)

- Show class diagram file (class-diagram-optimized.puml)
- **Explain UI class implementation** (using Context API)
  - Show UIContext code
  - Explain attributes and methods
  - Explain composition relationships (owns Dashboard, Filter, CarbonFootprint, etc.)
- Explain implemented core classes and methods
  - User abstract class and its subclasses (Admin, TeamMember)
  - CarbonFootprint class and its two modes
  - AccessControl class
- Emphasize principle of strict adherence to class diagram
- Show code implementation of key relationships (inheritance, composition, dependency)

#### 6. Skeleton Display (1 minute) - 🟢 Optional

- Show skeleton of other Dashboard pages (Water, Thermal)
- Explain Forecast class marked for future implementation (requires real prediction algorithms)
- Explain framework is set up, functionality is extensible

### Demo Data Preparation

- Create 2 test users (admin@sait.ca, john.doe@sait.ca)
- Prepare 3-6 months of electricity data
- Prepare corresponding carbon footprint data
- Ensure data associations are correct

### Technical Question Preparation

- How to implement inheritance relationships in class diagram?
- How to ensure carbon footprint data is displayed in electricity reports?
- How to implement permission control?
- How does database design correspond to ERD diagram?
- How do frontend and backend communicate?

---

## Next Steps (2025-11-28 Update)

### ✅ Completed (2025-11-27 ~ 2025-11-28)

**Environment Setup**:

- ✅ Created Vite + React project
- ✅ Installed all dependencies (Material-UI, Chart.js, React Router, etc.)
- ✅ Created Express backend server
- ✅ Configured environment variables (.env file)

**P0 Core Features**:

- ✅ Login module (100% complete)
- ✅ User management module (100% complete)
- ✅ Carbon footprint tracking module (100% complete)
  - ✅ Mode 1: Mock data automatic calculation
  - ✅ Mode 2: User temporary upload
  - ✅ Three views: Real-time, Daily, Long-term
  - ✅ Chart.js visualization
  - ✅ Electricity Maps API integration

**Architecture Implementation**:

- ✅ Component architecture (Container/Presentation pattern)
- ✅ Frontend-backend separation (RESTful API)
- ✅ Permission management system (multi-select permissions)
- ✅ Three-panel layout (Sidebar + Main + AI Chatbot)

### 🔄 Next Tasks (By Priority)

**P1 - Electricity Dashboard Module**:

1. ⏳ Create ElectricityDashboardPage component
2. ⏳ Implement Report and ElectricityReport classes
3. ⏳ Integrate carbon footprint data display
4. ⏳ Implement self-sufficiency rate calculation
5. ⏳ Add data filtering functionality

**Database Migration (Week 1-2)**:

1. ⏳ Design SQL Server table structure
2. ⏳ Create database migration scripts
3. ⏳ Update backend Service layer to connect to database
4. ⏳ Migrate Mock data to database
5. ⏳ Implement JWT token authentication

**P2 - Skeleton Implementation**:

1. ⏸️ Create WaterReport and ThermalReport classes (Skeleton)
2. ⏸️ Create Forecast class (Skeleton)
3. ⏸️ Create PeriodComparison class (Skeleton)
4. ⏸️ Create 3D visualization placeholder page

### Key Decision Records

- ✅ Use Mock data instead of SQL Server (Prototype phase)
- ✅ Use Session-based authentication instead of JWT (Prototype phase)
- ✅ Adopt component architecture (avoid God Mode)
- ✅ Integrate Electricity Maps API (real-time carbon intensity)
- ✅ Use Chart.js for data visualization
- ✅ System is internal, no registration feature

---

## Success Criteria (2025-11-28 Update)

### ✅ P0 Feature Completeness (Achieved)

- ✅ **Login and User Management**

  - ✅ Admin and TeamMember can successfully login and logout
  - ✅ Admin can add new users (no registration feature)
  - ✅ Admin can edit user information and permissions
  - ✅ Admin can delete users (cannot delete self)
  - ✅ Role-based routing correct (Admin → User Management, TeamMember → Dashboard)
  - ✅ Permission management system (multi-select permissions)
  - ✅ Sidebar permission filtering
- ✅ **Carbon Footprint Tracking (Two Modes)**

  - ✅ Mode 1: Automatically calculate carbon footprint from Mock data
  - ✅ Mode 2: User temporary upload calculation (not persisted)
  - ✅ Three views: Real-time, Daily, Long-term
  - ✅ Data visualization (Chart.js dual-line chart)
  - ✅ Historical data tracking
  - ✅ Date/time handling (local time, prevent future dates)
  - ✅ Electricity Maps API integration
- ✅ **Architecture Implementation**

  - ✅ Component architecture (Container/Presentation pattern)
  - ✅ Frontend-backend separation (RESTful API)
  - ✅ Three-panel layout (Sidebar + Main + AI Chatbot)
  - ✅ Responsive design
- ✅ **Class Diagram Compliance**

  - ✅ User, Admin, TeamMember, AccessControl classes implemented
  - ✅ Strictly follow class-diagram-optimized.puml
  - ✅ All attributes and methods complete

### ⏳ P1 Feature Goals (To Be Achieved)

- ⏳ **Electricity Dashboard**
  - ⏳ Display electricity consumption and generation data
  - ⏳ Integrate carbon footprint data display
  - ⏳ Self-sufficiency rate calculation
  - ⏳ Data filtering functionality

### Code Quality

- [ ] Code structure is clear, follows class diagram design
- [ ] All classes contain attributes and methods defined in class diagram
- [ ] Relationships between classes correctly implemented (inheritance, composition, dependency)
- [ ] Appropriate error handling (using UI.displayWarning())
- [ ] Necessary code comments (marking class diagram correspondence)
- [ ] Database design complies with standards (independent tables, foreign key constraints)

### Demo Readiness

- [ ] System can run stably
- [ ] Sufficient test data (at least 2 users: 1 Admin, 1 TeamMember)
- [ ] Test carbon footprint data (at least 3 months)
- [ ] UI interface is friendly, functionality is usable
- [ ] Can clearly demonstrate class diagram correspondence
- [ ] Can demonstrate two carbon footprint calculation modes
- [ ] Can demonstrate user management functionality
- [ ] Can answer technical questions

### Demo Focus

- [ ] **Non-trivial use case**: Carbon footprint tracking (two modes)
- [ ] **Internal system**: No registration feature, Admin manages users
- [ ] **Class diagram compliance**: Strictly implemented according to class diagram
- [ ] **UI class implementation**: Implemented UI class using Context API

---

**Last Updated**: 2025-11-28
**Document Version**: 4.0 (Updated based on actual development)
**Status**: P0 ✅ Completed | P1 ⏳ Pending

**Important Reminders**:

- All implementations must strictly follow `class-diagram-optimized.puml`
- **Prototype Priority**: Login + User Management + Carbon Footprint (two modes)
- System is **internal**, no registration feature, users managed by Admin
- Carbon footprint supports **two modes**: Database automatic calculation + User temporary upload
- UI class implemented using **Context API**, complies with class diagram requirements
- Forecast functionality requires **real prediction algorithms**, not implemented in Prototype phase
- This is the core requirement of Phase 3, must be clearly demonstrated

---

## Appendix: Quick Reference

### Key File Paths

```
instructions/
├── Phase3_extracted.md                    # Phase 3 requirements
├── ref/
│   ├── Phase2_extracted.md                # Phase 2 design documents
│   ├── CaseStudy_extracted.md             # Project management documents
│   ├── class-diagram-optimized.puml       # Class diagram (most important)
│   ├── erd-diagram.puml                   # ERD diagram
│   ├── deployment-diagram.puml            # Deployment diagram
│   ├── usecase-diagram.puml               # Use case diagram
│   └── figma/                             # UI design

deliverables/
├── seq-electricity-dashboard.puml         # Electricity dashboard sequence diagram
├── seq-ai-chatbot.puml                    # AI chatbot sequence diagram
├── seq-quiz-management.puml               # Quiz management sequence diagram
├── activity-electricity-dashboard.puml    # Electricity dashboard activity diagram
└── activity-ai-chatbot.puml               # AI chatbot activity diagram
```

### Core Class Quick Index

- **User** (abstract): id, firstName, lastName, email, password, role | createUser(), login(), logout()
- **CarbonFootprint**: id, co2Emission, billEntries | calculateFootprint(), addBillEntry(), overrideWithDIY()
- **BillEntry**: id, year, month, electricityUsage
- **ElectricityReport** (inherits Report): electricityConsumption, electricityGeneration | calculateCarbonFootprint(), generateHotspotMap(), generateCarbonVsConsumptionChart()
- **Dashboard**: id, dashboardType | generateView(), filterByPermissions()
- **Visualizer**: id, visualizeType | generateGraph(), calculateSelfSufficiency(), renderHotspotMap()

### Key Relationship Quick Index

- CarbonFootprint "1" --> "1" ElectricityReport : calculates
- UI "1" *-- "1" CarbonFootprint : owns
- ElectricityReport --|> Report : is-a
- Dashboard --> Visualizer : uses
- Dashboard ..> AccessControl : checks permission
