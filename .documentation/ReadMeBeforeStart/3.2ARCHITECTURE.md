# EcoSphere System Architecture Document

**Project**: EcoSphere - Smart Building Analytics System  
**Last Updated**: 2025-11-28  
**Version**: 1.0  
**Status**: âœ… P0 Completed | ğŸ”„ P1 In Progress

---

## ğŸ“‹ Table of Contents

1. [Architecture Overview](#1-architecture-overview)
2. [Technology Stack](#2-technology-stack)
3. [Project Structure](#3-project-structure)
4. [Class Design and Implementation](#4-class-design-and-implementation)
5. [API Architecture](#5-api-architecture)
6. [Component Architecture](#6-component-architecture)
7. [Frontend-Backend Relationship](#7-frontend-backend-relationship)
8. [Design Philosophy](#8-design-philosophy)
9. [Implementation Progress](#9-implementation-progress)

---

## 1. Architecture Overview

### 1.1 System Architecture

EcoSphere adopts a **three-tier architecture** design:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer (Frontend)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ UI Componentsâ”‚  â”‚ Service Layerâ”‚  â”‚  Context API â”‚     â”‚
â”‚  â”‚   (React)    â”‚  â”‚  (API Calls) â”‚  â”‚(State Mgmt)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ HTTP/JSON â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer (Backend)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Routes     â”‚â†’ â”‚ Controllers  â”‚â†’ â”‚  Services    â”‚     â”‚
â”‚  â”‚(API Endpointsâ”‚  â”‚(Request      â”‚  â”‚(Business     â”‚     â”‚
â”‚  â”‚              â”‚  â”‚ Handling)    â”‚  â”‚  Logic)      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ Data Operations â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Mock Data   â”‚  â”‚ External API â”‚  â”‚  Future: SQL â”‚     â”‚
â”‚  â”‚ (JSON Files) â”‚  â”‚(Electricity  â”‚  â”‚   Server     â”‚     â”‚
â”‚  â”‚              â”‚  â”‚    Maps)     â”‚  â”‚              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Core Modules

| Module | Status | Description |
|--------|--------|-------------|
| Login Module | âœ… Complete | User authentication and session management |
| User Management Module | âœ… Complete | Admin manages users and permissions |
| Carbon Footprint Tracking Module | âœ… Complete | Two calculation modes + visualization |
| Electricity Dashboard Module | â³ Pending | Electricity data display |

### 1.3 Data Flow

```
User Action â†’ UI Component â†’ Service Layer â†’ HTTP Request â†’ Backend API
                                                                â†“
                                                            Controller
                                                                â†“
                                                            Service
                                                                â†“
                                                            Data Source
                                                                â†“
                                                            JSON Response
                                                                â†“
Frontend Display â† UI Component â† Service Layer â† HTTP Response â† Backend API
```

---

## 2. Technology Stack

### 2.1 Frontend Technology Stack âœ…

| Technology | Version | Purpose | Reason for Choice |
|------------|---------|---------|-------------------|
| **Vite** | Latest | Build Tool | Fast startup, fast HMR |
| **React** | 18.x | UI Framework | Component-based, mature ecosystem |
| **Material-UI** | 5.x | UI Component Library | Professional, rich components |
| **Chart.js** | 4.x | Chart Library | Free, locally generated |
| **React Router** | 6.x | Routing | Standard routing solution |
| **Context API** | React Built-in | State Management | Lightweight, suitable for project scale |

**Why These Technologies**:
- **Vite**: Faster than Create React App, better development experience
- **Material-UI**: Provides professional UI components, complies with SAIT design standards
- **Chart.js**: Free, no external API needed, powerful features
- **Context API**: Project scale is moderate, doesn't need Redux complexity


### 2.2 Backend Technology Stack âœ…

| Technology | Version | Purpose | Reason for Choice |
|------------|---------|---------|-------------------|
| **Node.js** | 18.x+ | Runtime Environment | JavaScript full-stack |
| **Express.js** | 4.x | Web Framework | Simple, flexible |
| **RESTful API** | - | API Design | Standard, easy to understand |

**Architecture Pattern**: Routes â†’ Controllers â†’ Services â†’ Utils

### 2.3 Data Storage (Prototype Phase) âš ï¸

| Solution | Status | Description |
|----------|--------|-------------|
| **Mock Data** | âœ… Currently Used | JSON file storage |
| **SQL Server** | ğŸ”„ Future Migration | Week 1-2 planned |

**Mock Data Files**:
- `mock-data/users.json` - User data
- `mock-data/electricity.json` - Electricity data (3 months, hourly)
- `mock-data/carbonFootprint.json` - Carbon footprint historical data

**Why Use Mock Data**:
- Client data table structure not finalized
- Rapid development in Prototype phase
- Convenient for demo and testing

### 2.4 External API âœ…

| API | Purpose | Status |
|-----|---------|--------|
| **Electricity Maps API** | Get real-time carbon intensity (Alberta, Calgary) | âœ… Integrated |

---

## 3. Project Structure

### 3.1 Frontend Structure

```
ecosphere-frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/                 # Static resources
â”‚   â”‚   â”œâ”€â”€ loginbackground.jpg
â”‚   â”‚   â”œâ”€â”€ sait-logo_vert.svg
â”‚   â”‚   â””â”€â”€ sait-logo_horz.svg
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # React components
â”‚   â”‚   â”œâ”€â”€ Common/             # Common components
â”‚   â”‚   â”‚   â”œâ”€â”€ AlertMessage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.jsx
â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.jsx
â”‚   â”‚   â”œâ”€â”€ Layout/             # Layout components
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚   â”‚   â”‚   â””â”€â”€ AIChatbot.jsx
â”‚   â”‚   â”œâ”€â”€ UserManagement/     # User management components
â”‚   â”‚   â”‚   â”œâ”€â”€ UserTable.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ UserTableRow.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ UserDialog.jsx
â”‚   â”‚   â”‚   â””â”€â”€ UserForm.jsx
â”‚   â”‚   â””â”€â”€ CarbonFootprint/    # Carbon footprint components
â”‚   â”‚       â””â”€â”€ CustomCalculator.jsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                  # Page components (containers)
â”‚   â”‚   â”œâ”€â”€ LoginPage.jsx
â”‚   â”‚   â”œâ”€â”€ DashboardPage.jsx
â”‚   â”‚   â”œâ”€â”€ UserManagementPage.jsx
â”‚   â”‚   â”œâ”€â”€ CarbonFootprintPage.jsx
â”‚   â”‚   â””â”€â”€ ComingSoonPage.jsx
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/               # React Context
â”‚   â”‚   â””â”€â”€ AuthContext.jsx
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # Custom Hooks
â”‚   â”‚   â””â”€â”€ useAuth.js
â”‚   â”‚
â”‚   â”œâ”€â”€ services/               # API services
â”‚   â”‚   â”œâ”€â”€ UserService.js
â”‚   â”‚   â”œâ”€â”€ ElectricityService.js
â”‚   â”‚   â””â”€â”€ ElectricityMapsService.js
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # Data models (utility classes)
â”‚   â”‚   â”œâ”€â”€ User.js
â”‚   â”‚   â”œâ”€â”€ Admin.js
â”‚   â”‚   â”œâ”€â”€ TeamMember.js
â”‚   â”‚   â”œâ”€â”€ AccessControl.js
â”‚   â”‚   â”œâ”€â”€ CarbonFootprint.js
â”‚   â”‚   â”œâ”€â”€ BillEntry.js
â”‚   â”‚   â”œâ”€â”€ Report.js
â”‚   â”‚   â””â”€â”€ ElectricityReport.js
â”‚   â”‚
â”‚   â”œâ”€â”€ App.jsx                 # Main application component
â”‚   â”œâ”€â”€ main.jsx                # Entry file
â”‚   â””â”€â”€ index.css               # Global styles
â”‚
â”œâ”€â”€ .env                        # Environment variables
â”œâ”€â”€ package.json                # Dependencies configuration
â””â”€â”€ vite.config.js              # Vite configuration
```

### 3.2 Backend Structure

```
ecosphere-backend/
â”œâ”€â”€ config/                     # Configuration files
â”‚   â””â”€â”€ config.js
â”‚
â”œâ”€â”€ routes/                     # API routes
â”‚   â”œâ”€â”€ userRoutes.js
â”‚   â””â”€â”€ electricityRoutes.js
â”‚
â”œâ”€â”€ controllers/                # Controllers
â”‚   â”œâ”€â”€ userController.js
â”‚   â””â”€â”€ electricityController.js
â”‚
â”œâ”€â”€ services/                   # Business logic
â”‚   â”œâ”€â”€ userService.js
â”‚   â””â”€â”€ electricityService.js
â”‚
â”œâ”€â”€ models/                     # Data models (complete classes)
â”‚   â”œâ”€â”€ User.js
â”‚   â”œâ”€â”€ Admin.js
â”‚   â”œâ”€â”€ TeamMember.js
â”‚   â”œâ”€â”€ AccessControl.js
â”‚   â”œâ”€â”€ CarbonFootprint.js
â”‚   â”œâ”€â”€ BillEntry.js
â”‚   â”œâ”€â”€ Report.js
â”‚   â””â”€â”€ ElectricityReport.js
â”‚
â”œâ”€â”€ utils/                      # Utility functions
â”‚   â””â”€â”€ fileHelper.js
â”‚
â”œâ”€â”€ server.js                   # Server entry point
â”œâ”€â”€ .env                        # Environment variables
â””â”€â”€ package.json                # Dependencies configuration
```

### 3.3 Why This Organization

**Frontend Organization Principles**:
1. **Group by Feature**: components/ organized by functional modules
2. **Separation of Concerns**: pages/ (containers) vs components/ (presentation)
3. **Independent Service Layer**: services/ encapsulates all API calls
4. **Lightweight Model Layer**: models/ contains only utility classes

**Backend Organization Principles**:
1. **Layered Architecture**: Routes â†’ Controllers â†’ Services â†’ Models
2. **Single Responsibility**: Each layer only responsible for its own tasks
3. **Easy to Test**: Each layer can be tested independently
4. **Easy to Extend**: Adding new features only requires adding new files

---


## 4. Class Design and Implementation

### 4.1 Class Diagram Compliance Principles

All class designs strictly follow the definitions in `class-diagram-optimized.puml`.

**Design Principles**:
- âœ… All classes must include all attributes defined in the class diagram
- âœ… All methods must be implemented according to signatures in the class diagram
- âœ… Relationships between classes must be reflected in code
- âœ… Naming must be consistent with the class diagram

### 4.2 Implemented Classes (P0 - 100% Complete)

#### 4.2.1 User Class (Abstract Class) âœ…

**Package**: User Management  
**Frontend Location**: `ecosphere-frontend/src/models/User.js`  
**Backend Location**: `ecosphere-backend/models/User.js`

**Attributes**:
```javascript
- id: int
- firstName: String
- lastName: String
- email: String
- password: String
- role: String
```

**Methods**:
```javascript
+ createUser(id, firstName, lastName, email, password, role): void
+ login(): void
+ logout(): void
```

**Relationships**:
- Inherited by: `Admin --|> User`, `TeamMember --|> User`

---

#### 4.2.2 Admin Class (Inherits User) âœ…

**Package**: User Management  
**Frontend Location**: `ecosphere-frontend/src/models/Admin.js`  
**Backend Location**: `ecosphere-backend/models/Admin.js`

**Additional Methods**:
```javascript
+ addUser(userData): void
+ editUserPermissions(userId, permissions): void
+ assignRole(userId, role): void
+ createQuiz(): void
+ editQuiz(quizId): void
+ deleteQuiz(quizId): void
```

**Relationships**:
- Inheritance: `Admin --|> User`
- Dependency: `Admin ..> AccessControl : uses`

---

#### 4.2.3 TeamMember Class (Inherits User) âœ…

**Package**: User Management  
**Frontend Location**: `ecosphere-frontend/src/models/TeamMember.js`  
**Backend Location**: `ecosphere-backend/models/TeamMember.js`

**Additional Attributes**:
```javascript
- promptChat: int
- permissions: List<String>
```

**Additional Methods**:
```javascript
+ getPermissions(): List<String>
```

**Relationships**:
- Inheritance: `TeamMember --|> User`

---

#### 4.2.4 AccessControl Class âœ…

**Package**: Security  
**Frontend Location**: `ecosphere-frontend/src/models/AccessControl.js`  
**Backend Location**: `ecosphere-backend/models/AccessControl.js`

**Methods** (Static):
```javascript
+ checkPermission(user, module): boolean
+ updateUserPermissions(userId, permissions): void
```

**Relationships**:
- Used by: `Admin ..> AccessControl : uses`
- Depended on: `UI ..> AccessControl : checks permission`

---

#### 4.2.5 CarbonFootprint Functionality âœ…

**Implementation Method**: Implemented through Service layer (fully functional)

**Related Files**:
- `ElectricityMapsService.js` - Carbon intensity API and calculation
- `ElectricityService.js` - Electricity data management
- `CarbonFootprintPage.jsx` - Main page container
- `CustomCalculator.jsx` - User temporary calculation component

**Corresponding Class Diagram Methods**:
```javascript
+ calculateFootprint(electricityUsage, emissionFactor): double
+ addBillEntry(year, month, electricityUsage): void
+ overrideWithDIY(): DataSet
```

---

#### 4.2.6 BillEntry Functionality âœ…

**Implementation Method**: As React state in CustomCalculator component

**Data Structure**:
```javascript
{
  id: int,
  year: string,
  month: string,
  usage: number
}
```

---

### 4.3 Classes To Be Implemented (P1 - Pending)

#### 4.3.1 Report Class (Abstract Class) â³

**Package**: Reporting System  
**Planned Location**: `ecosphere-frontend/src/models/Report.js`

**Attributes**:
```javascript
- id: int
- reportType: String
```

**Methods**:
```javascript
+ exportReport(): void
+ filterReport(filters): void
```

---

#### 4.3.2 ElectricityReport Class (Inherits Report) â³

**Package**: Reporting System  
**Planned Location**: `ecosphere-frontend/src/models/ElectricityReport.js`

**Additional Attributes**:
```javascript
- electricityConsumption: double
- electricityGeneration: double
```

**Methods**:
```javascript
+ calculateCarbonFootprint(emissionFactor): double
+ generateHotspotMap(data): Map
+ generateCarbonVsConsumptionChart(): Chart
```

---

#### 4.3.3 Dashboard Class â³

**Package**: User Interface  
**Planned Location**: `ecosphere-frontend/src/models/Dashboard.js`

**Attributes**:
```javascript
- id: int
- dashboardType: String
```

**Methods**:
```javascript
+ generateView(user, type): DashboardView
+ filterByPermissions(user): List
```

---

#### 4.3.4 Visualizer Class â³

**Package**: Visualization  
**Planned Location**: `ecosphere-frontend/src/models/Visualizer.js`

**Attributes**:
```javascript
- id: int
- visualizeType: String
```

**Methods**:
```javascript
+ generateGraph(data, graphType): void
+ calculateSelfSufficiency(generation, consumption): double
+ renderHotspotMap(data): Map
```

---

### 4.4 Relationships Between Classes

#### Inheritance Relationships
```
User (abstract)
  â”œâ”€â”€ Admin âœ…
  â””â”€â”€ TeamMember âœ…

Report (abstract) â³
  â”œâ”€â”€ WaterReport â¸ï¸
  â”œâ”€â”€ ElectricityReport â³
  â””â”€â”€ ThermalReport â¸ï¸
```

#### Composition Relationships
```
UI *-- Dashboard (multiple) â³
UI *-- Filter (1) â¸ï¸
UI *-- ReportCustomization (1) â¸ï¸
UI *-- CarbonFootprint (1) âœ…
CarbonFootprint o-- BillEntry (multiple) âœ…
```

#### Dependency Relationships
```
Admin ..> AccessControl âœ…
UI ..> AccessControl âœ…
Dashboard ..> AccessControl â³
Report ..> AccessControl â³
```

---

### 4.5 Implementation Progress Statistics

| Priority | Total | Completed | Pending | Completion Rate |
|----------|-------|-----------|---------|-----------------|
| P0 | 6 | 6 | 0 | **100%** âœ… |
| P1 | 5 | 0 | 5 | 0% |
| P2 | 7 | 0 | 7 | 0% |
| **Total** | **18** | **6** | **12** | **33%** |

---


## 5. API Architecture

### 5.1 Frontend-Backend Communication Flow

#### Complete API Call Chain

```
Frontend                      Backend
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. UI Component              
   (UserManagementPage.jsx)
   â†“
2. Service Layer             
   (UserService.js)
   â†“ HTTP Request (fetch)
   
                             3. Route
                                (userRoutes.js)
                                â†“
                             4. Controller
                                (userController.js)
                                â†“
                             5. Service
                                (userService.js)
                                â†“
                             6. Data
                                (users.json)
                                â†“
   â† JSON Response â†         7. Response
```

#### Example: User Login Flow

**Frontend Code**:
```javascript
// 1. UI Component (LoginPage.jsx)
const handleLogin = async () => {
  const user = await UserService.authenticate(email, password);
  if (user) {
    navigate('/dashboard');
  }
};

// 2. Service Layer (UserService.js)
async authenticate(email, password) {
  const response = await fetch('http://localhost:3001/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  return await response.json();
}
```

**Backend Code**:
```javascript
// 3. Route Layer (userRoutes.js)
router.post('/auth/login', UserController.login);

// 4. Controller Layer (userController.js)
static async login(req, res) {
  const { email, password } = req.body;
  const user = await UserService.authenticate(email, password);
  
  if (user) {
    res.json(user);
  } else {
    res.status(401).json({ error: 'Invalid credentials' });
  }
}

// 5. Service Layer (userService.js)
static async authenticate(email, password) {
  const data = await FileHelper.readJSON('users.json');
  const user = data.users.find(u => 
    u.email === email && u.password === password
  );
  return user;
}
```

---

### 5.2 API Endpoint List

#### User Management API âœ…

| Method | Endpoint | Description | Frontend Call |
|--------|----------|-------------|---------------|
| GET | `/api/users` | Get all users | `UserService.getAllUsers()` |
| GET | `/api/users/:id` | Get single user | `UserService.getUserById(id)` |
| POST | `/api/users` | Create new user | `UserService.addUser(data)` |
| PUT | `/api/users/:id` | Update user | `UserService.updateUser(id, data)` |
| DELETE | `/api/users/:id` | Delete user | `UserService.deleteUser(id)` |
| POST | `/api/auth/login` | User login | `UserService.authenticate(email, pwd)` |

#### Electricity Data API âœ…

| Method | Endpoint | Description | Frontend Call |
|--------|----------|-------------|---------------|
| GET | `/api/electricity/realtime` | Get real-time data | `ElectricityService.getRealTimeData()` |
| GET | `/api/electricity/range?startDate=...&endDate=...` | Get range data | `ElectricityService.getDataByRange(start, end)` |
| GET | `/api/electricity/longterm` | Get long-term data | `ElectricityService.getLongTermData()` |
| GET | `/api/electricity/metadata` | Get metadata | `ElectricityService.getMetadata()` |

---

### 5.3 Service Layer Design

#### Why Need Service Layer

**Frontend Service Layer** (`src/services/`):
- âœ… Encapsulates all API calls
- âœ… Unified error handling
- âœ… Prevents components from directly calling APIs
- âœ… Easy to test and maintain

**Backend Service Layer** (`services/`):
- âœ… Encapsulates business logic
- âœ… Data operations and validation
- âœ… Separated from Controller
- âœ… Reusable business logic

#### Service vs Model Difference

| Aspect | Service | Model |
|--------|---------|-------|
| **Responsibility** | Business logic, data operations | Data structure, validation rules |
| **State** | Stateless (static methods) | Stateful (instances) |
| **Dependencies** | Can call Model | Doesn't depend on Service |
| **Example** | `UserService.authenticate()` | `new User()` |

---


## 6. Component Architecture

### 6.1 Component Principles

#### Why Need Componentization

**Avoid God Mode**:
- âŒ One component contains all logic (300+ lines of code)
- âŒ Difficult to maintain and test
- âŒ Cannot be reused
- âŒ Team collaboration difficult

**Benefits of Componentization**:
- âœ… Single responsibility, easy to understand
- âœ… Reusable, reduces duplicate code
- âœ… Easy to test
- âœ… Team can develop in parallel
- âœ… Easy to maintain and extend

#### Core Principles

1. **Single Responsibility Principle** - Each component does one thing
2. **Reusability** - Components can be used in multiple places
3. **Small and Focused** - Single component not exceeding 150 lines of code
4. **Clear Naming** - Component names clearly express functionality
5. **Container/Presentation Pattern** - Separate data logic and UI presentation

---

### 6.2 Component Categories

#### Common Components âœ…

Basic components that can be used throughout the application.

**Examples**:
- `AlertMessage` - Alert messages
- `ErrorBoundary` - Error boundary
- `LoadingSpinner` - Loading animation

**Characteristics**:
- Highly reusable
- No business logic
- Configured through props

---

#### Feature Components âœ…

Components for specific functional modules.

**Examples**:
- `UserManagement/` - User management related
  - `UserTable` - User list table
  - `UserTableRow` - Table row
  - `UserDialog` - Add/edit dialog
  - `UserForm` - User form
- `CarbonFootprint/` - Carbon footprint related
  - `CustomCalculator` - Custom calculator

**Characteristics**:
- Targeted at specific functionality
- May contain some business logic
- Reused within functional modules

---

#### Layout Components âœ…

Application layout structure components.

**Examples**:
- `Sidebar` - Sidebar
- `AIChatbot` - AI assistant

**Characteristics**:
- Define application structure
- Used across multiple pages
- Usually contain navigation logic

---

#### Page Components âœ…

Top-level container components, corresponding to routes.

**Examples**:
- `LoginPage` - Login page
- `UserManagementPage` - User management page
- `CarbonFootprintPage` - Carbon footprint page
- `DashboardPage` - Dashboard page

**Characteristics**:
- Container components
- Responsible for data fetching
- Compose child components
- Correspond to routes

---

### 6.3 Componentization Example: UserManagement

#### Before Refactoring (God Mode) âŒ

```javascript
// UserManagementPage.jsx - 300+ lines
const UserManagementPage = () => {
  // 10+ state variables
  // 10+ functions
  // All UI rendering logic
  return (
    <Container>
      {/* 300+ lines of JSX */}
    </Container>
  );
};
```

**Problems**:
- 300+ lines of code in one file
- Difficult to understand and maintain
- Cannot reuse any part
- Testing difficult

---

#### After Refactoring (Componentized) âœ…

```javascript
// UserManagementPage.jsx - 180 lines (container component)
const UserManagementPage = () => {
  // Data management and business logic
  return (
    <Container>
      <AlertMessage {...alertProps} />
      <UserTable {...tableProps} />
      <UserDialog {...dialogProps} />
    </Container>
  );
};

// UserTable.jsx - 40 lines (presentation component)
const UserTable = ({ users, onEdit, onDelete }) => {
  return (
    <Table>
      {users.map(user => (
        <UserTableRow key={user.id} user={user} {...actions} />
      ))}
    </Table>
  );
};

// UserTableRow.jsx - 45 lines (presentation component)
const UserTableRow = ({ user, onEdit, onDelete }) => {
  return <TableRow>{/* User information */}</TableRow>;
};

// UserDialog.jsx - 30 lines (presentation component)
const UserDialog = ({ open, onClose, onSubmit }) => {
  return (
    <Dialog open={open}>
      <UserForm {...formProps} />
    </Dialog>
  );
};

// UserForm.jsx - 60 lines (presentation component)
const UserForm = ({ formData, onChange }) => {
  return <Box>{/* Form fields */}</Box>;
};
```

**Effect Comparison**:

| Metric | Before Refactoring | After Refactoring |
|--------|-------------------|-------------------|
| Single file lines of code | 300+ | Max 180 |
| Number of components | 1 | 6 |
| Reusable components | 0 | 5 |
| Testability | Difficult | Easy |
| Maintainability | Low | High |
| Team collaboration | Difficult | Easy |

---


## 7. Frontend-Backend Relationship

### 7.1 Why Both Frontend and Backend Have User.js

This is a common question: Why do both frontend and backend have files with the same name?

#### Frontend User.js (Utility Class)

**Location**: `ecosphere-frontend/src/models/User.js`

**Responsibilities**:
- âœ… Provide utility functions (UserUtils)
- âœ… Data validation
- âœ… Formatting
- âœ… Lightweight, stateless

**Example**:
```javascript
// Frontend User.js - Utility class
class UserUtils {
  static validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
  
  static formatName(firstName, lastName) {
    return `${firstName} ${lastName}`;
  }
}
```

---

#### Backend User.js (Complete Class)

**Location**: `ecosphere-backend/models/User.js`

**Responsibilities**:
- âœ… Complete class definition
- âœ… Business logic
- âœ… Data operations
- âœ… Complies with class diagram design

**Example**:
```javascript
// Backend User.js - Complete class
class User {
  constructor() {
    this.id = null;
    this.firstName = '';
    this.lastName = '';
    this.email = '';
    this.password = '';
    this.role = '';
  }

  createUser(id, firstName, lastName, email, password, role) {
    // Complete business logic
  }

  login() {
    // Login logic
  }

  logout() {
    // Logout logic
  }
}
```

---

#### Responsibility Separation

| Aspect | Frontend User.js | Backend User.js |
|--------|------------------|-----------------|
| **Type** | Utility class (Utils) | Complete class (Model) |
| **Responsibility** | Helper functions | Business logic |
| **State** | Stateless | Stateful |
| **Complexity** | Simple | Complex |
| **Dependencies** | None | May depend on other classes |

**Why This Design**:
- âœ… Frontend doesn't need complete business logic
- âœ… Frontend only needs utility functions
- âœ… Backend responsible for core business logic
- âœ… Clear responsibilities, easy to maintain

---

### 7.2 Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. UI Component (React)                                    â”‚
â”‚     â””â”€â”€ UserManagementPage.jsx                              â”‚
â”‚         â†“ Calls                                              â”‚
â”‚  2. Service Layer (API calls)                               â”‚
â”‚     â””â”€â”€ UserService.js                                      â”‚
â”‚         â†“ HTTP Request (JSON)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    HTTP/JSON
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  3. Routes (API endpoint definition)                        â”‚
â”‚     â””â”€â”€ userRoutes.js                                       â”‚
â”‚         â†“ Routes to                                          â”‚
â”‚  4. Controller (Request handling)                           â”‚
â”‚     â””â”€â”€ userController.js                                   â”‚
â”‚         â†“ Calls                                              â”‚
â”‚  5. Service (Business logic)                                â”‚
â”‚     â””â”€â”€ userService.js                                      â”‚
â”‚         â†“ Uses                                               â”‚
â”‚  6. Model (Data model)                                      â”‚
â”‚     â””â”€â”€ User.js                                             â”‚
â”‚         â†“ Operates                                           â”‚
â”‚  7. Data Storage                                            â”‚
â”‚     â””â”€â”€ users.json (Mock data)                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 7.3 State Management

#### Why Use Context API Instead of Redux

**Context API Advantages**:
- âœ… React built-in, no extra dependencies
- âœ… Lightweight, suitable for small to medium projects
- âœ… Low learning curve
- âœ… Sufficient for current needs

**Redux Disadvantages** (for this project):
- âŒ Requires extra dependencies
- âŒ Complex configuration (store, reducers, actions)
- âŒ Large code volume
- âŒ Too complex for current project scale

**Currently Used Context**:
- `AuthContext` - Authentication state management
  - Current user information
  - Login/logout state
  - Permission information

---


## 8. Design Philosophy

### 8.1 Why Adopt Component Architecture

**Problem**: Traditional monolithic components (God Mode)

```javascript
// âŒ Bad practice
const UserManagementPage = () => {
  // 300+ lines of code
  // - All state management
  // - All business logic
  // - All UI rendering
  // - All event handlers
};
```

**Solution**: Component architecture

```javascript
// âœ… Good practice
const UserManagementPage = () => {
  // Only responsible for composition and data management
  return (
    <>
      <AlertMessage />
      <UserTable />
      <UserDialog />
    </>
  );
};
```

**Benefits**:
1. **Easy to Understand** - Each component has single responsibility
2. **Easy to Test** - Can test each component independently
3. **Easy to Reuse** - Components can be used in multiple places
4. **Easy to Maintain** - Modifying one component doesn't affect others
5. **Team Collaboration** - Different people can develop different components

---

### 8.2 Why Use Mock Data

**Reasons**:
1. **Client data table structure not finalized**
   - GBTAC's SQL Server table structure still under discussion
   - Avoid frequent database design changes

2. **Rapid development in Prototype phase**
   - No need to configure database connections
   - No need to handle database permissions
   - Faster development speed

3. **Convenient for demo and testing**
   - Controllable data, convenient for demo
   - Can quickly reset data
   - Not dependent on external database

**Future Plans**:
- ğŸ”„ Week 1-2 migration to SQL Server
- ğŸ”„ Implement real database connections
- ğŸ”„ Implement data migration scripts

---

### 8.3 Why Choose These Technologies

#### Vite vs Create React App

| Aspect | Vite | CRA |
|--------|------|-----|
| Startup Speed | âš¡ Extremely fast (seconds) | ğŸŒ Slow (minutes) |
| Hot Reload | âš¡ Instant | ğŸŒ Slower |
| Build Speed | âš¡ Fast | ğŸŒ Slow |
| Configuration | Simple | Complex |
| Modernity | Latest | Older |

**Choose Vite**: Better development experience, faster speed

---

#### Material-UI vs Bootstrap

| Aspect | Material-UI | Bootstrap |
|--------|-------------|-----------|
| Component Richness | â­â­â­â­â­ | â­â­â­ |
| Customizability | â­â­â­â­â­ | â­â­â­ |
| React Integration | â­â­â­â­â­ | â­â­â­ |
| Documentation Quality | â­â­â­â­â­ | â­â­â­â­ |
| Professionalism | High | Medium |

**Choose Material-UI**: More professional, richer components, more suitable for enterprise applications

---

#### Chart.js vs Plotly.js

| Aspect | Chart.js | Plotly.js |
|--------|----------|-----------|
| File Size | Small | Large |
| Free | âœ… Completely free | âš ï¸ Some features paid |
| Local Generation | âœ… Yes | âœ… Yes |
| Learning Curve | Low | High |
| Features | Sufficient | More powerful |

**Choose Chart.js**: Free, lightweight, sufficient for needs

---

#### Context API vs Redux

| Aspect | Context API | Redux |
|--------|-------------|-------|
| Learning Curve | Low | High |
| Code Volume | Less | More |
| Configuration Complexity | Low | High |
| Suitable Project Scale | Small to Medium | Large |
| React Integration | Built-in | Requires extra library |

**Choose Context API**: Project scale is moderate, doesn't need Redux complexity

---

### 8.4 Design Decision Records

#### Decision #1: Use Mock Data Instead of SQL Server
**Date**: 2025-11-27  
**Decision**: Use Mock data in Prototype phase  
**Reason**: Client data table structure not finalized, rapid development  
**Impact**: Week 1-2 need to migrate to SQL Server

---

#### Decision #2: Use Session-based Authentication Instead of JWT
**Date**: 2025-11-27  
**Decision**: Use sessionStorage to store user information  
**Reason**: Simplified implementation in Prototype phase  
**Impact**: Future need to implement JWT token authentication

---

#### Decision #3: Adopt Component Architecture
**Date**: 2025-11-28  
**Decision**: Split large components into multiple small components  
**Reason**: Avoid God Mode, improve maintainability  
**Impact**: Code organization clearer, easier to maintain

---

#### Decision #4: Integrate Electricity Maps API
**Date**: 2025-11-28  
**Decision**: Use external API to get real-time carbon intensity  
**Reason**: Provide real carbon intensity data  
**Impact**: Need to manage API keys

---


## 9. Implementation Progress

### 9.1 Completed (P0 - 100%) âœ…

#### Login Module âœ…

**Features**:
- âœ… User login interface (email/password)
- âœ… Authentication and Session management
- âœ… Role-based routing (Admin â†’ User Management, TeamMember â†’ Dashboard)

**Implementation Files**:
- Frontend: `LoginPage.jsx`, `AuthContext.jsx`, `useAuth.js`
- Backend: `userRoutes.js`, `userController.js`, `userService.js`

**Test Accounts**:
- Admin: `admin.admin@edu.sait.ca` / `abcd1234`

---

#### User Management Module âœ…

**Features**:
- âœ… View user list
- âœ… Add new user
- âœ… Edit user information
- âœ… Delete user (cannot delete self)
- âœ… Assign roles and permissions
- âœ… Multi-select permissions (Electricity, Water, Thermal, 3D Model, Carbon Footprint)
- âœ… Sidebar permission filtering

**Implementation Files**:
- Frontend Components: `UserManagementPage.jsx`, `UserTable.jsx`, `UserTableRow.jsx`, `UserDialog.jsx`, `UserForm.jsx`
- Frontend Service: `UserService.js`
- Backend API: `userRoutes.js`, `userController.js`, `userService.js`

**Implemented Classes**:
- âœ… User (abstract class)
- âœ… Admin (inherits User)
- âœ… TeamMember (inherits User)
- âœ… AccessControl

---

#### Carbon Footprint Tracking Module âœ…

**Features**:
- âœ… **Mode 1: Mock Data Automatic Calculation**
  - âœ… Read electricity data from electricity.json
  - âœ… Integrate Electricity Maps API to get real-time carbon intensity
  - âœ… Automatically calculate carbon footprint (CO2 = electricity consumption Ã— carbon intensity)
  - âœ… Three views: Real-time (today), Daily (user-selected), Long-term (3 months)
  
- âœ… **Mode 2: User Temporary Upload (Custom Calculator)**
  - âœ… User uploads electricity bill (year, month, electricity usage)
  - âœ… Real-time carbon footprint calculation
  - âœ… Data not persisted (only exists in React state)
  - âœ… Dynamically add/remove bill entries
  - âœ… Data validation (prevent duplicates, prevent future dates)
  - âœ… Automatic sorting (by year/month)
  
- âœ… **Data Visualization**
  - âœ… Chart.js dual-line chart
  - âœ… Dual Y-axis (left: kg CO2, right: kWh)
  - âœ… SAIT color scheme
  - âœ… Responsive design

**Implementation Files**:
- Frontend Page: `CarbonFootprintPage.jsx`
- Frontend Component: `CustomCalculator.jsx`
- Frontend Service: `ElectricityService.js`, `ElectricityMapsService.js`
- Backend API: `electricityRoutes.js`, `electricityController.js`, `electricityService.js`
- Mock Data: `electricity.json`, `carbonFootprint.json`

**Implemented Functionality**:
- âœ… CarbonFootprint functionality (through Service layer)
- âœ… BillEntry functionality (through CustomCalculator component)

---

### 9.2 In Progress (P1 - 0%) â³

#### Electricity Dashboard Module â³

**Planned Features**:
- â³ Display electricity consumption and generation data
- â³ Integrate carbon footprint data display
- â³ Self-sufficiency rate calculation
- â³ Data filtering functionality

**Classes To Be Implemented**:
- â³ Report (abstract class)
- â³ ElectricityReport (inherits Report)
- â³ Dashboard
- â³ Visualizer

**Technology Stack**:
- Continue using Chart.js
- Continue using Mock data
- Integrate completed carbon footprint functionality

---

### 9.3 Planned (P2 - Skeleton) â¸ï¸

#### Other Report Modules â¸ï¸

**Plans**:
- â¸ï¸ WaterReport class (Skeleton)
- â¸ï¸ ThermalReport class (Skeleton)
- â¸ï¸ Placeholder pages

---

#### Advanced Features â¸ï¸

**Plans**:
- â¸ï¸ Forecast class (Skeleton) - Prediction functionality
- â¸ï¸ PeriodComparison class (Skeleton) - Period comparison
- â¸ï¸ Filter class (Skeleton) - Data filtering
- â¸ï¸ ReportCustomization class (Skeleton) - Report customization
- â¸ï¸ 3D visualization (Skeleton)

---

### 9.4 Future Improvements (Week 1-15)

#### Week 1-2: Database Migration
- ğŸ”„ Connect to SQL Server database
- ğŸ”„ Create database tables
- ğŸ”„ Implement data migration scripts
- ğŸ”„ Update Service layer

#### Week 3-5: Authentication System Upgrade
- ğŸ”„ Implement JWT token authentication
- ğŸ”„ Implement token refresh mechanism
- ğŸ”„ Implement password encryption (bcrypt)

#### Week 7-9: Complete Report Module
- ğŸ”„ Implement complete ElectricityReport
- ğŸ”„ Implement WaterReport
- ğŸ”„ Implement ThermalReport
- ğŸ”„ Integrate Weather API

#### Week 11-12: Advanced Features
- ğŸ”„ AI Chatbot (Google Gemini API)
- ğŸ”„ Quiz System (QR code)
- ğŸ”„ 3D Thermal Visualization (Three.js)
- ğŸ”„ Prediction functionality (real algorithms)

---

## 10. Quick Reference

### 10.1 Key File Locations

| Feature | Frontend File | Backend File |
|---------|---------------|--------------|
| Login | `LoginPage.jsx` | `userRoutes.js` |
| User Management | `UserManagementPage.jsx` | `userController.js` |
| Carbon Footprint | `CarbonFootprintPage.jsx` | `electricityController.js` |
| Permission Control | `AccessControl.js` | `AccessControl.js` |

### 10.2 Startup Commands

**Backend**:
```bash
cd ecosphere-backend
npm start
# Runs on http://localhost:3001
```

**Frontend**:
```bash
cd ecosphere-frontend
npm run dev
# Runs on http://localhost:5174
```

### 10.3 Test Accounts

- **Admin**: `admin.admin@edu.sait.ca` / `abcd1234`
- **TeamMember**: Created by Admin

---

## 11. Summary

### 11.1 Architecture Advantages

1. **Clear Layering** - Frontend, backend, data layer responsibilities clear
2. **Component Design** - Easy to maintain and extend
3. **Frontend-Backend Separation** - Independent development and deployment
4. **Complies with Class Diagram** - Strictly follows design documents
5. **Easy to Understand** - Clear logic, complete documentation

### 11.2 Current Status

- âœ… **P0 Features**: 100% complete
- â³ **P1 Features**: 0% pending
- â¸ï¸ **P2 Features**: 0% Skeleton

### 11.3 Next Steps

1. Implement Electricity Dashboard module (P1)
2. Prepare for database migration (Week 1-2)
3. Implement Skeleton features (P2)

---

## ğŸ“š Related Documents

- **Project Introduction**: `1.EcoSphereIntroduction.md`
- **Implementation Plan**: `2.2IMPLEMENTATION_PLAN.md`
- **Development Log**: `4.2log.md`
- **Class Diagram**: `diagram/class-diagram-optimized.puml`
- **ERD Diagram**: `diagram/erd-diagram.puml`

---

**Document Version**: 1.0  
**Last Updated**: 2025-11-28  
**Updated By**: Kiro AI

---

**EcoSphere System Architecture Document Complete!** âœ…
