// Script to generate mock electricity data for GBTAC building
// Simulates sensor data from 2024-01-01 to 2025-11-28
// Run: node generate-electricity-data.js

const fs = require('fs');
const path = require('path');

/**
 * Generate realistic electricity data for GBTAC building
 * Building: 3-story office building in Calgary, Alberta
 * Power range: 10-80 kW depending on time and season
 */
function generateElectricityData() {
  const data = [];
  let seq = 1000000000; // Start sequence number
  
  // Start: 2024-01-01 00:00:00
  // End: 2025-11-28 23:59:59
  const startDate = new Date('2024-01-01T00:00:00');
  const endDate = new Date('2025-11-28T23:59:59');
  
  // Calculate total hours
  const totalHours = Math.floor((endDate - startDate) / (1000 * 60 * 60)) + 1;
  
  console.log(`Generating ${totalHours} hourly records...`);
  
  for (let i = 0; i < totalHours; i++) {
    const currentDate = new Date(startDate);
    currentDate.setHours(startDate.getHours() + i);
    
    // Get hour, day of week, month for realistic patterns
    const hour = currentDate.getHours();
    const dayOfWeek = currentDate.getDay(); // 0=Sunday, 6=Saturday
    const month = currentDate.getMonth(); // 0=Jan, 11=Dec
    
    // Base load: 15-25 kW (always on systems, lighting, HVAC baseline)
    let power = 18000 + Math.random() * 7000; // 18-25 kW
    
    // Business hours pattern (8am-6pm, Mon-Fri)
    const isBusinessHours = hour >= 8 && hour <= 18;
    const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5;
    
    if (isBusinessHours && isWeekday) {
      // Peak office hours: 40-70 kW
      power += 25000 + Math.random() * 20000; // +25-45 kW
    } else if (isBusinessHours && !isWeekday) {
      // Weekend daytime: 20-35 kW (reduced occupancy)
      power += 5000 + Math.random() * 10000; // +5-15 kW
    } else if (hour >= 22 || hour <= 6) {
      // Night hours: 10-18 kW (minimal operations)
      power -= 5000 + Math.random() * 3000; // -5-8 kW
    }
    
    // Seasonal variation (heating/cooling)
    // Winter (Dec, Jan, Feb): +20% for heating
    // Summer (Jun, Jul, Aug): +15% for cooling
    if (month === 11 || month === 0 || month === 1) {
      power *= 1.15 + Math.random() * 0.1; // +15-25%
    } else if (month >= 5 && month <= 7) {
      power *= 1.10 + Math.random() * 0.08; // +10-18%
    }
    
    // Add realistic noise/variation
    power += (Math.random() - 0.5) * 2000; // Â±1 kW random variation
    
    // Ensure power is positive and round to realistic precision
    power = Math.max(8000, power); // Minimum 8 kW
    power = Math.round(power * 100) / 100; // Round to 2 decimals
    
    // Format timestamp with milliseconds (SQL Server format)
    const ts = currentDate.toISOString()
      .replace('T', ' ')
      .replace('Z', '')
      .substring(0, 19) + '.0000000';
    
    data.push({
      seq: seq++,
      ts: ts,
      value: power
    });
    
    // Progress indicator
    if (i % 1000 === 0) {
      console.log(`Progress: ${i}/${totalHours} records (${Math.round(i/totalHours*100)}%)`);
    }
  }
  
  return data;
}

// Generate data
console.log('=== GBTAC Electricity Data Generator ===');
console.log('Building: 3-story office building');
console.log('Location: Calgary, Alberta');
console.log('Time range: 2024-01-01 to 2025-11-28');
console.log('');

const electricityData = generateElectricityData();

// Create JSON structure
const output = {
  metadata: {
    building: "GBTAC (Green Building Technology Access Centre)",
    location: "SAIT, Calgary, Alberta, Canada",
    buildingType: "3-story office building",
    startDate: "2024-01-01",
    endDate: "2025-11-28",
    totalRecords: electricityData.length,
    interval: "hourly",
    unit: "W (Watts)",
    description: "Mock electricity consumption data from building sensors",
    note: "This is temporary mock data. Will be replaced with real SQL Server data in production.",
    dataFormat: {
      seq: "Sequence number (auto-generated by database)",
      ts: "Timestamp in SQL Server format (YYYY-MM-DD HH:MM:SS.0000000)",
      value: "Power consumption in Watts (W)"
    }
  },
  data: electricityData
};

// Write to file
const filePath = path.join(__dirname, 'electricity.json');
fs.writeFileSync(filePath, JSON.stringify(output, null, 2));

console.log('');
console.log('âœ… Generation complete!');
console.log(`ðŸ“ File: ${filePath}`);
console.log(`ðŸ“Š Total records: ${electricityData.length}`);
console.log(`ðŸ“… Date range: ${electricityData[0].ts} to ${electricityData[electricityData.length - 1].ts}`);
console.log(`âš¡ Power range: ${Math.min(...electricityData.map(d => d.value)).toFixed(2)} W to ${Math.max(...electricityData.map(d => d.value)).toFixed(2)} W`);
console.log(`ðŸ’¾ File size: ${(fs.statSync(filePath).size / 1024 / 1024).toFixed(2)} MB`);
